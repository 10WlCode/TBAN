<!DOCTYPE html>
<!-- saved from url=(0031)http://www.jqhtml.com/7399.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>性能优化  –  前端开发，JQUERY特效，全栈开发，vue开发</title>
<meta name="description" content="更新UI时，React在内部使用几种巧妙的技术来最小化DOM操作的数量。对许多应用来说，使用React不需要做太多的优化工作就可以快速创建用户界面。除此之外，还有一些优化React应用性能的办法。


使用生产版本
在R…">
<meta name="keywords" content="">
<script src="./性能优化_files/hm.js.下载"></script><script src="./性能优化_files/push.js.下载"></script><script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9900392079887997",
    enable_page_level_ads: true
  });
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();

</script>
<meta name="360-site-verification" content="e65ff9c8e6cec15bab7efa4415a86607">
<link href="./性能优化_files/style.css" rel="stylesheet">
<link href="./性能优化_files/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="./性能优化_files/jquery.min.js.下载"></script><style type="text/css">
:root #content > #right > .dose > .dosesingle,
:root #content > #center > .dose > .dosesingle,
:root #header + #content > #left > #rlblock_left,
:root header + .container > .ads:first-child
{ display: none !important; }</style>
<script type="text/javascript" src="./性能优化_files/jquery.lazyload.min.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/main.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/CateNav.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/shCore.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/shBrushJScript.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/shBrushXml.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/shBrushCss.js.下载"></script>

<script type="text/javascript" src="./性能优化_files/shBrushPhp.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/shBrushPython.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/shBrushSql.js.下载"></script>
<script type="text/javascript" src="./性能优化_files/shBrushJava.js.下载"></script>
<link href="./性能优化_files/shCoreEclipse.css" rel="stylesheet">

</head><div style="display: block; opacity: 1;"></div>
<body>
    <div id="header" class="header-box-shadow">
        <div class="header-c">
            <a href="http://www.jqhtml.com/" class="logo"><img src="./性能优化_files/logo.png"></a>
            <div class="nav"><ul id="menu-%e5%af%bc%e8%88%aa" class="nav-ul"><li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-12"><a href="http://www.jqhtml.com/">首页</a><span></span></li>
<li id="menu-item-5182" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5182"><a href="http://www.jqhtml.com/category/article">前端</a><span></span></li>
<li id="menu-item-11231" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11231"><a href="http://www.jqhtml.com/category/python">Python</a><span></span></li>
<li id="menu-item-14089" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14089"><a href="http://www.jqhtml.com/category/java">Java</a><span></span></li>
</ul></div>            <span class="line"></span>
            <div class="nav nav2"><ul id="menu-%e5%a4%b4%e9%83%a8%e5%af%bc%e8%88%aa" class="nav-ul"><li id="menu-item-11232" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-11232 nav-active"><a href="http://www.jqhtml.com/category/tutorial">教程</a><span></span></li>
<li id="menu-item-11233" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11233"><a href="http://www.jqhtml.com/category/manual">手册</a><span></span></li>
</ul></div>            
            <form action="http://www.jqhtml.com/" method="get" class="search">
                <div>
                    <input type="text" value="" name="s" id="s" class="search-text">
                    <input type="hidden" name="cat" value="">
                    <input type="submit" id="searchsubmit" value="" class="search-btn">
                    <button><i class="fa fa-lg fa-search"></i></button>
                </div>
            </form>

        </div>
    </div>
    <div id="header-m">
        <a href="http://www.jqhtml.com/" class="logo"><img src="./性能优化_files/logo.png"></a>
        <div class="select-atitle">
            <p>教程<span></span></p>
            <div class="nav-m"><ul id="menu-%e5%a4%b4%e9%83%a8%e5%af%bc%e8%88%aa%e6%89%8b%e6%9c%ba%e7%89%88" class="nav-ul"><li id="menu-item-11234" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-11234"><a href="http://www.jqhtml.com/">首页</a><span></span></li>
<li id="menu-item-11235" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11235"><a href="http://www.jqhtml.com/category/article">前端</a><span></span></li>
<li id="menu-item-11236" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11236"><a href="http://www.jqhtml.com/category/python">Python</a><span></span></li>
<li id="menu-item-14090" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14090"><a href="http://www.jqhtml.com/category/java">Java</a><span></span></li>
<li id="menu-item-11237" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-11237"><a href="http://www.jqhtml.com/category/tutorial">教程</a><span></span></li>
<li id="menu-item-11238" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11238"><a href="http://www.jqhtml.com/category/manual">手册</a><span></span></li>
</ul></div>        </div>
        
        <form action="http://www.jqhtml.com/" method="get" class="search-m">
            <div>
                <input type="text" value="" name="s" id="s" class="search-text" placeholder="请输入关键字">
                <input type="hidden" name="cat" value="">
                <input type="submit" id="searchsubmit" value="" class="search-btn">
                <button><i class="fa fa-lg fa-search"></i></button>
            </div>
        </form>
    </div>
    <div class="placeholder"></div>
    
<style type="text/css">
#header .header-c{
	/*width: 1280px !important;*/
}
</style>

<div id="content">
	<div class="content-tutorial">
		<div class="content-tutorial-c">
			<div class="bar-btn-p">
				<div class="bar-btn"></div>
			</div>
			<div class="content-tutorial-left">

				<h2>目录</h2>
				<div class="bar-btn-p bar-btn-p-mu">
					<div class="bar-btn"></div>
				</div>
				<div class="tutorial-left-bar">
					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7300.html" id="7300">安装</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7303.html" id="7303">Hello World</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7307.html" id="7307">JSX 简介</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7309.html" id="7309">元素渲染</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7314.html" id="7314">组件 &amp; Props</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7316.html" id="7316">State &amp; 生命周期</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7321.html" id="7321">事件处理</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7323.html" id="7323">条件渲染</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7325.html" id="7325">列表 &amp; Keys</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7332.html" id="7332">表单</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7358.html" id="7358">状态提升</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7363.html" id="7363">组合 vs 继承</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7370.html" id="7370">React 理念</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7376.html" id="7376">深入 JSX</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7389.html" id="7389">使用 PropTypes 进行类型检查</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7391.html" id="7391">Refs &amp; DOM</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7395.html" id="7395">非受控组件</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7399.html" id="7399" class="linka" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">性能优化</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7407.html" id="7407">不使用 ES6</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7409.html" id="7409">不使用 JSX</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7411.html" id="7411">协调（Reconciliation）</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7415.html" id="7415">Context</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7419.html" id="7419">Web Components</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7421.html" id="7421">高阶组件</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7424.html" id="7424">与第三方库协同</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7429.html" id="7429">React 高阶 API</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7434.html" id="7434">React.Component</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7439.html" id="7439">ReactDOM</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7442.html" id="7442">ReactDOMServer</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7446.html" id="7446">DOM Elements</a>
					</div>
					


					 


					
										<div class="second">
						<a href="http://www.jqhtml.com/7449.html" id="7449">SyntheticEvent</a>
					</div>
					


					  
				</div>
			</div>
			<div class="content-tutorial-center content-article" style="margin-top:0 !important;">
							    			    <p class="categorytitle">
				React入门教程			    </p>
				<h1 style="font-size: 26px;font-weight: normal;font-family: 微软雅黑;" id="7399">性能优化</h1>
			    <div class="entry art_content" id="art_content">

				<p>更新UI时，React在内部使用几种巧妙的技术来最小化DOM操作的数量。对许多应用来说，使用React不需要做太多的优化工作就可以快速创建用户界面。除此之外，还有一些优化React应用性能的办法。</p>
<h2><a name="1"></a>使用生产版本</h2>
<p>在React应用中检测性能问题时，请务必使用压缩过的生产版本。</p>
<p>默认情况下，React包含很多在开发过程中很有帮助的警告。然而，这会导致React更大更慢。因此，在部署应用时，请确认使用了生产版本。</p>
<p>如果你不确定构建过程是否正确，可以安装<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi" target="_blank">React开发者工具（chrome）</a>。当你访问一个生产模式的React页面时，这个工具的图标会有一个黑色的背景：<br>
<img src="./性能优化_files/react612-4.png" alt="react612-4" width="600" height="127" class="alignnone size-full wp-image-7401" srcset="http://www.jqhtml.com/wp-content/uploads/2017/06/react612-4.png 600w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-4-300x64.png 300w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-4-272x58.png 272w" sizes="(max-width: 600px) 100vw, 600px"></p>
<p>当你访问一个开发模式的React页面时，这个工具的图标会有一个红色的背景：<br>
<img src="./性能优化_files/react612-5.png" alt="react612-5" width="600" height="200" class="alignnone size-full wp-image-7402" srcset="http://www.jqhtml.com/wp-content/uploads/2017/06/react612-5.png 600w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-5-300x100.png 300w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-5-272x91.png 272w" sizes="(max-width: 600px) 100vw, 600px"></p>
<p>最好在开发应用时使用开发模式，部署应用时换为生产模式。</p>
<p>以下是构建生产用应用的流程。</p>
<h2><a name="2"></a>Create React App方式</h2>
<p>如果你的项目是以<a href="https://github.com/facebookincubator/create-react-app" target="_blank">Create React App</a>创建的，运行如下代码：</p>
<div><div id="highlighter_224914" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">npm run build</code></div></div></td></tr></tbody></table></div></div>
<p>这将会在该项目的build/文件夹内创建一个生产版本的应用。</p>
<p>注意只有发布项目时才有必要这样做，正常开发时，使用npm start。</p>
<h3><a name="2_1"></a>单文件生产版本</h3>
<p>我们提供压缩好的生产版本的React和React DOM文件:</p>
<div><div id="highlighter_219119" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">&lt;script src=</code><code class="js string">"<a href="https://unpkg.com/react@15/dist/react.min.js">https://unpkg.com/react@15/dist/react.min.js</a>"</code><code class="js plain">&gt;&lt;/script&gt;</code></div><div class="line number2 index1 alt1"><code class="js plain">&lt;script src=</code><code class="js string">"<a href="https://unpkg.com/react-dom@15/dist/react-dom.min.js">https://unpkg.com/react-dom@15/dist/react-dom.min.js</a>"</code><code class="js plain">&gt;&lt;/script&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>注意只有结尾为.min.js的React文件才是适合生产使用的。</p>
<h3><a name="2_2"></a>Brunch</h3>
<p>为了创建最高效的Brunch生产版本，需要安装uglify-js-brunch 插件:</p>
<div><div id="highlighter_721758" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js preprocessor"># If you use npm</code></div><div class="line number2 index1 alt1"><code class="js plain">npm install --save-dev uglify-js-brunch</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="js preprocessor"># If you use Yarn</code></div><div class="line number5 index4 alt2"><code class="js plain">yarn add --dev uglify-js-brunch</code></div></div></td></tr></tbody></table></div></div>
<p>接下来，为了构建生产版本，在build命令后添加-p参数：</p>
<div><div id="highlighter_119780" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">brunch build -p</code></div></div></td></tr></tbody></table></div></div>
<p>注意只有生产版本需要这样操作。不要在开发环境中安装这个插件或者使用-p参数，因为它会隐藏掉有用的React警告并使构建过程更慢。</p>
<h2><a name="3"></a>Browserify</h2>
<p>为了创建最高效的Browserify生产版本，需要安装一些插件：</p>
<div><div id="highlighter_957991" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js preprocessor"># If you use npm</code></div><div class="line number2 index1 alt1"><code class="js plain">npm install --save-dev bundle-collapser envify uglify-js uglifyify</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="js preprocessor"># If you use Yarn</code></div><div class="line number5 index4 alt2"><code class="js plain">yarn add --dev bundle-collapser envify uglify-js uglifyify </code></div></div></td></tr></tbody></table></div></div>
<p>为了构建生产版本，务必添加这些设置指令 (参数很重要):</p>
<ul>
<li>envify该插件确保正确的编译环境，全局安装（-g）。</li>
<li>uglifyify该插件移除了开发接口。全局安装（-g）。</li>
<li>bundle-collapser该插件用数字替代了长长的模块ID。</li>
<li>最后，以上结果都被输添加至uglify-js来得到整合。(了解原因).</li>
</ul>
<p>举个例子：</p>
<div><div id="highlighter_431667" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">browserify ./index.js \</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">-g [ envify --NODE_ENV production ] \</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">-g uglifyify \</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">-p bundle-collapser/plugin \</code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">| uglifyjs --compress --mangle &gt; ./bundle.js</code></div></div></td></tr></tbody></table></div></div>
<blockquote><p>
注意：<br>
包的名称是uglify-js，但是它提供的文件叫uglifyjs。<br>
这不是一个错字。
</p></blockquote>
<p>注意只有生产版本需要这样操作。不要在开发环境中安装这些插件，因为它们会隐藏掉有用的React警告并使构建过程更慢。</p>
<h3><a name="3_1"></a>Rollup</h3>
<p>为了创建最高效的Rollup生产版本，需要安装一些插件：</p>
<div><div id="highlighter_598395" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js preprocessor"># If you use npm</code></div><div class="line number2 index1 alt1"><code class="js plain">npm install --save-dev rollup-plugin-commonjs rollup-plugin-replace rollup-plugin-uglify</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="js preprocessor"># If you use Yarn</code></div><div class="line number5 index4 alt2"><code class="js plain">yarn add --dev rollup-plugin-commonjs rollup-plugin-replace rollup-plugin-uglify </code></div></div></td></tr></tbody></table></div></div>
<p>为了构建生产版本，务必添加这些插件 (参数很重要):</p>
<ul>
<li>replace该插件确保正确的编译环境。</li>
<li>commonjs该插件在Rollup内提供对CommonJS的支持。</li>
<li>uglify该插件压缩生成最终版本。</li>
</ul>
<div><div id="highlighter_781194" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">plugins: [</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">// ...</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">require(</code><code class="js string">'rollup-plugin-replace'</code><code class="js plain">)({</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js string">'process.env.NODE_ENV'</code><code class="js plain">: JSON.stringify(</code><code class="js string">'production'</code><code class="js plain">)</code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}),</code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">require(</code><code class="js string">'rollup-plugin-commonjs'</code><code class="js plain">)(),</code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">require(</code><code class="js string">'rollup-plugin-uglify'</code><code class="js plain">)(),</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">// ...</code></div><div class="line number9 index8 alt2"><code class="js plain">]</code></div></div></td></tr></tbody></table></div></div>
<p>查看完整的<a href="https://gist.github.com/Rich-Harris/cb14f4bc0670c47d00d191565be36bf0" target="_blank">安装例子.</a></p>
<p>注意只有生产版本需要这样操作。不要在开发环境中安装uglify和replace，因为它们会隐藏掉有用的React警告并使构建过程更慢。</p>
<h3><a name="3_2"></a>Webpack</h3>
<blockquote><p>注意：<br>
如果你正在使用Create React App方式，参考上述文档。<br>
本节只适用于直接配置Webpack的情况。<br>
为了创建最高效的Webpack生产版本，需要在生产版本的配置中添加这些插件：
</p></blockquote>
<p>为了创建最高效的Webpack生产版本，需要在生产版本的配置中添加这些插件：</p>
<div><div id="highlighter_827282" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js keyword">new</code> <code class="js plain">webpack.DefinePlugin({</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js string">'process.env'</code><code class="js plain">: {</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">NODE_ENV: JSON.stringify(</code><code class="js string">'production'</code><code class="js plain">)</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number5 index4 alt2"><code class="js plain">}),</code></div><div class="line number6 index5 alt1"><code class="js keyword">new</code> <code class="js plain">webpack.optimize.UglifyJsPlugin()</code></div></div></td></tr></tbody></table></div></div>
<p>了解更多参见<a href="https://webpack.js.org/guides/production-build/" target="_blank">Webpack文档</a>.</p>
<p>注意只有生产版本需要这样操作。不要在开发环境中安装UglifyJsPlugin和DefinePlugin，因为它们会隐藏掉有用的React警告并使构建过程更慢。</p>
<h2><a name="4"></a>使用Chrome Timeline归档组件</h2>
<p>在开发模式下， 在支持的浏览器内使用性能工具可以直观的了解组件何时挂载，更新和卸载。例如：</p>
<p><img src="./性能优化_files/react612-6.png" alt="react612-6" width="651" height="228" class="alignnone size-full wp-image-7403" srcset="http://www.jqhtml.com/wp-content/uploads/2017/06/react612-6.png 651w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-6-300x105.png 300w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-6-272x95.png 272w" sizes="(max-width: 651px) 100vw, 651px"><br>
Chrome浏览器内：</p>
<p>1、在项目地址栏内添加查询字符串 ?react_perf（例如， http://localhost:3000/?react_perf）。</p>
<p>2、打开Chrome开发工具Timeline 按tab键然后选Record.</p>
<p>3、执行你想要分析的动作。不要记录超过20s，不然Chrome可能会挂起。</p>
<p>4、停止记录。</p>
<p>5、React事件将会被归类在 User Timing标签下。</p>
<p>注意由于这些数字是相对的，因此组件在生产版本中会运行更快。然而，这也能够帮助你了解何时会有无关的组件被错误的更新，以及你的组件更新的深度和频率。</p>
<p>目前浏览器中仅有Chrome，Edge和IE支持此特性，但是我们使用此标准用户<a href="https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API" target="_blank">Timing API</a>，因此我们期待更多的浏览器对其添加支持。</p>
<h2><a name="5"></a>避免重复渲染</h2>
<p>React在渲染出的UI内部建立和维护了一个内层的实现方式，它包括了从组件返回的React元素。这种实现方式使得React避免了一些不必要的创建和关联DOM节点，因为这样做可能比直接操作JavaScript对象更慢一些。有时它被称之为“虚拟DOM”，但是它其实和React Native的工作方式是一样的。</p>
<p>当一个组件的props或者state改变时，React通过比较新返回的元素和之前渲染的元素来决定是否有必要更新实际的DOM。当他们不相等时，React会更新DOM。</p>
<p>在一些情况下，你的组件可以通过重写这个生命周期函数shouldComponentUpdate来提升速度， 它是在重新渲染过程开始前触发的。 这个函数默认返回true，可使React执行更新：</p>
<div><div id="highlighter_406512" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">shouldComponentUpdate(nextProps, nextState) {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js keyword">true</code><code class="js plain">;</code></div><div class="line number3 index2 alt2"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>如果你知道在某些情况下你的组件不需要更新，你可以在shouldComponentUpdate内返回false来跳过整个渲染进程，该进程包括了对该组件和之后的内容调用render()指令。</p>
<h2><a name="6"></a>shouldComponentUpdate应用</h2>
<p>这是一个组件的子树。对其中每个组件来说，SCU表明了shouldComponentUpdate的返回内容，vDOMEq表明了待渲染的React元素与原始元素是否相等，最后，圆圈的颜色表明这个组件是否需要重新渲染。</p>
<p><img src="./性能优化_files/react612-7.png" alt="react612-7" width="555" height="371" class="alignnone size-full wp-image-7405" srcset="http://www.jqhtml.com/wp-content/uploads/2017/06/react612-7.png 555w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-7-300x201.png 300w, http://www.jqhtml.com/wp-content/uploads/2017/06/react612-7-272x182.png 272w" sizes="(max-width: 555px) 100vw, 555px"><br>
由于以C2为根的子树的shouldComponentUpdate返回了false，React不会试图渲染C2，甚至不会在C4和C5上调用shouldComponentUpdate。</p>
<p>对C1和C3来说，shouldComponentUpdate返回了true，因此React会深入到分支中并检查它们。C6的shouldComponentUpdate返回了true，由于待渲染的元素与原始元素并不相等，React会更新这个DOM节点。</p>
<p>最后一个有趣的情况是C8，React需要渲染这个组件，但是由于组件元素返回值与原元素相等，因此它并没有更新这个DOM节点。</p>
<p>注意React只需更新C6，因为它是不可避免的。对C8来说，它通过比较待渲染元素与原始元素避免了渲染，对C2的子树和C7，它们甚至都没有执行比较，因为我们设置了shouldComponentUpdate为false，render没有被调用。</p>
<h2><a name="7"></a>案例</h2>
<p>如果想让组件只在props.color或者state.count的值变化时重新渲染，你可以像下面这样设定shouldComponentUpdate：</p>
<div><div id="highlighter_201345" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">class CounterButton extends React.Component {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">constructor(props) {</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">super</code><code class="js plain">(props);</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">this</code><code class="js plain">.state = {count: 1};</code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">shouldComponentUpdate(nextProps, nextState) {</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code> <code class="js plain">(</code><code class="js keyword">this</code><code class="js plain">.props.color !== nextProps.color) {</code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js keyword">true</code><code class="js plain">;</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code> <code class="js plain">(</code><code class="js keyword">this</code><code class="js plain">.state.count !== nextState.count) {</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js keyword">true</code><code class="js plain">;</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js keyword">false</code><code class="js plain">;</code></div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">render() {</code></div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js plain">(</code></div><div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;button color=</code><code class="js string">"{this.props.color}"</code> <code class="js plain">onclick=</code><code class="js string">"{()"</code> <code class="js plain">==</code><code class="js string">""</code><code class="js plain">&gt; </code><code class="js keyword">this</code><code class="js plain">.setState(state =&gt; ({count: state.count + 1}))}&gt;</code></div><div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">Count: {</code><code class="js keyword">this</code><code class="js plain">.state.count}</code></div><div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;/button&gt;</code></div><div class="line number22 index21 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">);</code></div><div class="line number23 index22 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number24 index23 alt1"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>在以上代码中，shouldComponentUpdate只检查props.color和state.count的变化。如果这些值没有变化，组件就不会更新。当你的组件变得更加复杂时，你可以使用类似的模式来做一个“浅比较”，用来比较属性和值以判定是否需要更新组件。这种模式十分常见，因此React提供了一个辅助对象来实现这个逻辑 – 继承自React.PureComponent。以下代码可以更简单的实现相同的操作：</p>
<div><div id="highlighter_683279" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">class CounterButton extends React.PureComponent {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">constructor(props) {</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">super</code><code class="js plain">(props);</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">this</code><code class="js plain">.state = {count: 1};</code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">render() {</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js plain">(</code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;button color=</code><code class="js string">"{this.props.color}"</code> <code class="js plain">onclick=</code><code class="js string">"{()"</code> <code class="js plain">==</code><code class="js string">""</code><code class="js plain">&gt; </code><code class="js keyword">this</code><code class="js plain">.setState(state =&gt; ({count: state.count + 1}))}&gt;</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">Count: {</code><code class="js keyword">this</code><code class="js plain">.state.count}</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;/button&gt;</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">);</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number14 index13 alt1"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>大部分情况下，你可以使用React.PureComponent而不必写你自己的shouldComponentUpdate，它只做一个浅比较。但是由于浅比较会忽略属性或状态突变的情况，此时你不能使用它。</p>
<p>对于更复杂的数据结构这可能成为一个问题。例如，假设你想要一个ListOfWords组件来渲染一个逗号分隔的单词列表，并使用一个带了点击按钮名字叫WordAdder的父组件来给子列表添加一个单词。以下代码并不正确：</p>
<div><div id="highlighter_970903" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">class ListOfWords extends React.PureComponent {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">render() {</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js plain">&lt;div&gt;{</code><code class="js keyword">this</code><code class="js plain">.props.words.join(</code><code class="js string">','</code><code class="js plain">)}&lt;/div&gt;;</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number5 index4 alt2"><code class="js plain">}</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="js plain">class WordAdder extends React.Component {</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">constructor(props) {</code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">super</code><code class="js plain">(props);</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">this</code><code class="js plain">.state = {</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">words: [</code><code class="js string">'marklar'</code><code class="js plain">]</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">};</code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">this</code><code class="js plain">.handleClick = </code><code class="js keyword">this</code><code class="js plain">.handleClick.bind(</code><code class="js keyword">this</code><code class="js plain">);</code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">handleClick() {</code></div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">// This section is bad style and causes a bug</code></div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">const words = </code><code class="js keyword">this</code><code class="js plain">.state.words;</code></div><div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">words.push(</code><code class="js string">'marklar'</code><code class="js plain">);</code></div><div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">this</code><code class="js plain">.setState({words: words});</code></div><div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">render() {</code></div><div class="line number24 index23 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js plain">(</code></div><div class="line number25 index24 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;div&gt;</code></div><div class="line number26 index25 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;button onclick=</code><code class="js string">"{this.handleClick}"</code><code class="js plain">&gt;</code></div><div class="line number27 index26 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;listofwords words=</code><code class="js string">"{this.state.words}"</code><code class="js plain">&gt;</code></div><div class="line number28 index27 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">&lt;/listofwords&gt;&lt;/button&gt;&lt;/div&gt;</code></div><div class="line number29 index28 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">);</code></div><div class="line number30 index29 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}</code></div><div class="line number31 index30 alt2"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>问题是PureComponent将会在this.props.words的新旧值之间做一个简单的比较。由于代码中words数组在WordAdder的handleClick方法中被改变了，尽管数组中的实际单词已经改变，this.props.words的新旧值还是相等的，因此即便ListOfWords具有应该被渲染的新单词，它还是不会更新。</p>
<h2><a name="8"></a>不会突变的数据的力量</h2>
<p>避免此类问题最简单的方式是避免使用值可能会突变的属性或状态。例如，上面例子中的handleClick应该用concat重写成：</p>
<div><div id="highlighter_54472" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">handleClick() {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">this</code><code class="js plain">.setState(prevState =&gt; ({</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">words: prevState.words.concat([</code><code class="js string">'marklar'</code><code class="js plain">])</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}));</code></div><div class="line number5 index4 alt2"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>ES6支持数组的spread语法可以让它变得更容易。如果你使用的是Create React App，那么此语法默认可用。</p>
<div><div id="highlighter_21919" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">handleClick() {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">this</code><code class="js plain">.setState(prevState =&gt; ({</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">words: [...prevState.words, </code><code class="js string">'marklar'</code><code class="js plain">],</code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">}));</code></div><div class="line number5 index4 alt2"><code class="js plain">};</code></div></div></td></tr></tbody></table></div></div>
<p>你也可以用相似的方式重写可以会突变的对象。例如，假设我们有一个叫colormap的对象，我们想写一个把colormap.right改变成’blue’的函数，我们应该写：</p>
<div><div id="highlighter_436716" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js keyword">function</code> <code class="js plain">updateColorMap(colormap) {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js plain">colormap.right = </code><code class="js string">'blue'</code><code class="js plain">;</code></div><div class="line number3 index2 alt2"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>想要实现代码而不污染原始对象，我们可以使用Object.assign方法：</p>
<div><div id="highlighter_143309" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js keyword">function</code> <code class="js plain">updateColorMap(colormap) {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js plain">Object.assign({}, colormap, {right: </code><code class="js string">'blue'</code><code class="js plain">});</code></div><div class="line number3 index2 alt2"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>updateColorMap现在会返回一个新对象，而不会改变之前的旧对象。Object.assign在ES6中，需要polyfill支持。</p>
<p>有一个JavaScript提议来添加对象spread属性以便不会突然变化的更新对象：</p>
<div><div id="highlighter_155859" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js keyword">function</code> <code class="js plain">updateColorMap(colormap) {</code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js plain">{...colormap, right: </code><code class="js string">'blue'</code><code class="js plain">};</code></div><div class="line number3 index2 alt2"><code class="js plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>如果使用Create React App，默认情况下 Object.assign和spread对象都可以使用。</p>
<h2><a name="9"></a>使用不可突变的数据结构</h2>
<p>Immutable.js是解决这个问题的另一种方法。它通过结构共享提供不可突变的，持久的集合：</p>
<ul>
<li>不可突变:一旦创建，集合就不能在另一个时间点改变。</li>
<li>持久性:可以使用原始集合和一个突变来创建新的集合。原始集合在新集合创建后仍然可用。</li>
<li>结构共享:新集合尽可能多的使用原始集合的结构来创建，以便将复制操作降至最少从而提升性能。</li>
</ul>
<p>不可突变数据使得变化跟踪很方便。每个变化都会导致产生一个新的对象，因此我们只需检查索引对象是否改变。例如，在这个常见的JavaScript代码中：</p>
<div><div id="highlighter_163671" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">const x = { foo: </code><code class="js string">'bar'</code> <code class="js plain">};</code></div><div class="line number2 index1 alt1"><code class="js plain">const y = x;</code></div><div class="line number3 index2 alt2"><code class="js plain">y.foo = </code><code class="js string">'baz'</code><code class="js plain">;</code></div><div class="line number4 index3 alt1"><code class="js plain">x === y; </code><code class="js comments">// true</code></div></div></td></tr></tbody></table></div></div>
<p>虽然y被编辑了，但是由于它与x索引了相同的对象，这个比较会返回true。你可以使用immutable.js实现类似效果：</p>
<div><div id="highlighter_867514" class="syntaxhighlighter nogutter  js"><div class="toolbar"><span><a href="http://www.jqhtml.com/7399.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">const SomeRecord = Immutable.Record({ foo: </code><code class="js keyword">null</code> <code class="js plain">});</code></div><div class="line number2 index1 alt1"><code class="js plain">const x = </code><code class="js keyword">new</code> <code class="js plain">SomeRecord({ foo: </code><code class="js string">'bar'</code> <code class="js plain">});</code></div><div class="line number3 index2 alt2"><code class="js plain">const y = x.set(</code><code class="js string">'foo'</code><code class="js plain">, </code><code class="js string">'baz'</code><code class="js plain">);</code></div><div class="line number4 index3 alt1"><code class="js plain">x === y; </code><code class="js comments">// false</code></div></div></td></tr></tbody></table></div></div>
<p>在这个例子中，x突变后返回了一个新的索引，因此我们可以安全的确认x被改变了。</p>
<p>还有两个库可以帮助我们使用不可突变数据：<a href="https://github.com/rtfeldman/seamless-immutable" target="_blank">seamless-immutable</a> 和<a href="https://github.com/kolodny/immutability-helper" target="_blank">immutability-helper</a>。</p>
<p>实现shouldComponentUpdate时，不可突变的数据结构帮助我们轻松的追踪对象变化。这通常可以提供一个不错的性能提升。</p>
				</div>
							    			</div>
			<div class="content-tutorial-right" style="position: absolute;right: 0;">
				<div id="Catalog_box" style="height: 0px;">

					<div id="toolbar" style="height: 310px; display: none;">
						<div id="toolbar-c" style="height: 150px;"></div>
					</div>
				<dl style="display: block; position: absolute; background: rgb(0, 0, 0);" id="odl"><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">1</span><a href="http://www.jqhtml.com/7399.html#1" style="color: rgb(255, 255, 255); font-size: 12px;">使用生产版本</a></dd><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">2</span><a href="http://www.jqhtml.com/7399.html#2" style="color: rgb(255, 255, 255); font-size: 12px;">Create React App方式</a></dd><dd class="cate-item2"><span style="color: rgb(255, 255, 255); font-size: 12px;">2.1</span><a href="http://www.jqhtml.com/7399.html#2_1" style="color: rgb(255, 255, 255); font-size: 12px;">单文件生产版本</a></dd><dd class="cate-item2"><span style="color: rgb(255, 255, 255); font-size: 12px;">2.2</span><a href="http://www.jqhtml.com/7399.html#2_2" style="color: rgb(255, 255, 255); font-size: 12px;">Brunch</a></dd><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">3</span><a href="http://www.jqhtml.com/7399.html#3" style="color: rgb(255, 255, 255); font-size: 12px;">Browserify</a></dd><dd class="cate-item2"><span style="color: rgb(255, 255, 255); font-size: 12px;">3.1</span><a href="http://www.jqhtml.com/7399.html#3_1" style="color: rgb(255, 255, 255); font-size: 12px;">Rollup</a></dd><dd class="cate-item2"><span style="color: rgb(255, 255, 255); font-size: 12px;">3.2</span><a href="http://www.jqhtml.com/7399.html#3_2" style="color: rgb(255, 255, 255); font-size: 12px;">Webpack</a></dd><dd class="cate-item1 active"><span style="color: rgb(255, 255, 255); font-size: 12px;">4</span><a href="http://www.jqhtml.com/7399.html#4" style="color: rgb(255, 255, 255); font-size: 12px;">使用Chrome Timeline归档组件</a></dd><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">5</span><a href="http://www.jqhtml.com/7399.html#5" style="color: rgb(255, 255, 255); font-size: 12px;">避免重复渲染</a></dd><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">6</span><a href="http://www.jqhtml.com/7399.html#6" style="color: rgb(255, 255, 255); font-size: 12px;">shouldComponentUpdate应用</a></dd><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">7</span><a href="http://www.jqhtml.com/7399.html#7" style="color: rgb(255, 255, 255); font-size: 12px;">案例</a></dd><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">8</span><a href="http://www.jqhtml.com/7399.html#8" style="color: rgb(255, 255, 255); font-size: 12px;">不会突变的数据的力量</a></dd><dd class="cate-item1"><span style="color: rgb(255, 255, 255); font-size: 12px;">9</span><a href="http://www.jqhtml.com/7399.html#9" style="color: rgb(255, 255, 255); font-size: 12px;">使用不可突变的数据结构</a></dd></dl></div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(function(){
		SyntaxHighlighter.defaults['gutter'] = false;
	    // SyntaxHighlighter.defaults['html-script'] = false;
	    SyntaxHighlighter.all();
	    $.CateNav('#art_content','#Catalog_box');
	    $('#Catalog_box').height('400');
	    $('#Catalog_box').height($('#Catalog_box').height()-90);
	    $('#toolbar-c').height('150');
	    $('#toolbar').height($('#Catalog_box').height());

	    $('#odl').css('background','#000');

	    var CatalogHeight = $('#Catalog_box').css('height');
	    $('#Catalog_box a,#Catalog_box span').css({
	    	'color':'#fff',
	    	'fontSize':'12px'
	    });
	    $('#Catalog_box').css('height','0');

	    $('.bar-btn').click(function(){
	    	if($('#Catalog_box').css('height')=='0px'){
	    		$('#Catalog_box').css('height',CatalogHeight);
	    		$('.bar-btn').css('backgroundImage','url(wp-content/themes/sc/images/manual/close.png)');
		    } else {
		    	$('#Catalog_box').css('height',0);
		    	$('.bar-btn').css('backgroundImage','url(wp-content/themes/sc/images/manual/Menu.png)');
		    }
	    })


	    if($('#odl').length<=0 || $('#odl').height()< '400' ){
	    	$('#toolbar').css('display','none');
	    	return false;
	    }

	    var toolbar = document.getElementById('toolbar');
		var toolbarC = document.getElementById('toolbar-c');
		var catalogBox = document.getElementById('Catalog_box');
		var oDl = document.getElementById('odl');
		
		

		var iMaxTop = toolbar.offsetHeight - toolbarC.offsetHeight;
	
		toolbarC.onmousedown = function(ev) {
			
			var ev = ev || event;
			var disY = ev.clientY - this.offsetTop;
			document.onmousemove = function(ev) {
				var ev = ev || event;
				var T = ev.clientY - disY;
				if ( T < 0 ) {
					T = 0;
				} else if ( T > iMaxTop ) {
					T = iMaxTop;
				}
				toolbarC.style.top = T + 'px';
				var iScale = T / iMaxTop;
				oDl.style.top = (catalogBox.clientHeight - oDl.offsetHeight) * iScale + 'px';
			}
			document.onmouseup = function() {
				document.onmousemove = document.onmouseup = null;
			}
			return false;
		}

	})
</script>
    <div id="footer">
        <div class="footer-c">
            <div class="footer-nav">
                <ul>
                    <li><a href="http://www.jqhtml.com/7399.html#">关于我们</a></li>
                    <li><a href="http://www.jqhtml.com/7399.html#">联系我们</a></li>
                    <li><a href="http://www.jqhtml.com/7399.html#">广告服务</a></li>
                    <li><a href="http://www.jqhtml.com/7399.html#">免责声明</a></li>
                </ul>
            </div>
            <p>© 2012-2016 jqhtml.com · 湘ICP备16001111号-1  · 托管于 阿里云 &amp; 又拍云</p>
            <p>
            
            <script type="text/javascript">
            // // $LAB.script("http://www.jqhtml.com/wp-content/themes/sc/js/jquery-1.8.3.js")
            //     $LAB.script("http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js")
            //     .wait()    // 空的wait()只是确保script1在其他代码之前被执行
            //     .script("http://www.jqhtml.com/wp-content/themes/sc/js/jquery.lazyload.min.js")    // script2 和 script3 依赖于 script1
            //     .wait()    // 但是script2 和 script3 并不互相依赖,可以并行下载
            //     .script("http://www.jqhtml.com/wp-content/themes/sc/js/main.js")    //script4 依赖于 script1, script2 及 script3 .wait(function(){script4Func();});
            </script>
            <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "//hm.baidu.com/hm.js?8319b3b0fd09fd3d636159d4e490cdd8";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
            })();
            </script>
            </p>
        </div>
    </div>
    

</body></html>