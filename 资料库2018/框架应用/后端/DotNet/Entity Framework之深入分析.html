<!DOCTYPE html>
<!-- saved from url=(0061)http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Entity Framework之深入分析 - 小城岁月 - 博客园</title>
<link type="text/css" rel="stylesheet" href="./Entity Framework之深入分析_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./Entity Framework之深入分析_files/bundle-AnotherEon001.css">
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./Entity Framework之深入分析_files/bundle-AnotherEon001-mobile.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/mecity/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/mecity/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/mecity/wlwmanifest.xml">
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript" src="./Entity Framework之深入分析_files/encoder.js.下载"></script><script src="./Entity Framework之深入分析_files/jquery.js.下载" type="text/javascript"></script><style type="text/css">:root .sidebar-image,
:root .my_money,
:root .h_ads,
:root .focus-gg,
:root .ad_right,
:root .adPopup,
:root #header + #content > #left > #rlblock_left
{display:none !important;}</style>  
<script type="text/javascript">var currentBlogApp = 'mecity', cb_enable_mathjax=false;var isLogined=true;</script>
<script src="./Entity Framework之深入分析_files/blog-common.js.下载" type="text/javascript"></script>
<style type="text/css">:root #content > #center > .dose > .dosesingle,
:root #content > #right > .dose > .dosesingle
{display:none !important;}</style></head>
<body><link href="./Entity Framework之深入分析_files/jiathis_share.css" rel="stylesheet" type="text/css"><div class="jiathis_style" style="height: auto; position: fixed; z-index: 100000000; top: 150px; right: 0px; overflow: hidden; width: 26px;"><table cellpadding="0" cellspacing="0"><tbody style="background:transparent"><tr><td style="background:transparent"><img src="./Entity Framework之深入分析_files/r3.gif" style="cursor:pointer;" onmouseover="$CKE.over()" onclick="$CKE.center(this)"></td><td><div><div class="jiadiv_01"><div style="width:100%;background:#F2F2F2;border-bottom:1px solid #E5E5E5;line-height:200%;padding-left:5px;font-size:12px"><table width="100%"><tbody><tr class="jt_sharetitle"><td align="left" style="text-align:left;line-height:25px;font-size:14px;font-weight:bold;color:#000000;">分享到...</td><td align="right" style="text-align:right;"><img src="./Entity Framework之深入分析_files/img_exit.gif" border="0" style="opacity:0.5;filter:alpha(opacity=50);margin:0 10px;cursor:pointer;" onclick="$CKE.shareClose();"></td></tr></tbody></table></div><div class="jiadiv_02" style="width:100%;" id="jiathis_sers"><a href="javascript:;" onclick="jiathis_sendto(&#39;weixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_weixin">微信</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsina&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsina">微博</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;copy&#39;);return false;" class="jiatitle"><span class="jtico jtico_copy">复制网址</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;email&#39;);return false;" class="jiatitle"><span class="jtico jtico_email">邮件</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_cqq">QQ好友</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_qzone">QQ空间</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;renren&#39;);return false;" class="jiatitle"><span class="jtico jtico_renren">人人网</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;kaixin001&#39;);return false;" class="jiatitle"><span class="jtico jtico_kaixin001">开心网</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;evernote&#39;);return false;" class="jiatitle"><span class="jtico jtico_evernote">印象笔记</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;linkedin&#39;);return false;" class="jiatitle"><span class="jtico jtico_linkedin">领英</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;feixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_feixin">飞信</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban">豆瓣</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;twitter&#39;);return false;" class="jiatitle"><span class="jtico jtico_twitter">Twitter</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fb&#39;);return false;" class="jiatitle"><span class="jtico jtico_fb">Facebook</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ishare&#39;);return false;" class="jiatitle"><span class="jtico jtico_ishare">一键分享</span></a><a href="javascript:;" onclick="$CKE.center(this);return false;" class="jiatitle"><span class="jtico jtico_jiathis">查看更多(96)</span></a><div style="clear:both"></div></div><div class="ckepopBottom" style="width:100%;"><div style="float:left;font-size:10px"><a href="http://www.jiathis.com/help/html/what-is-jiathis" class="link_01" style="color:#333333;display:none;" target="_blank">这是什么工具?</a></div><div style="float:right;font-size:11px;margin:0 5px 0 0;"><img src="./Entity Framework之深入分析_files/img_012.gif" align="absmiddle" border="0"><a href="http://www.jiathis.com/index2" style="color:#333333;padding:0 3px;" class="link_01" target="_blank">JiaThis</a></div><div style="clear:both"></div></div></div></div></td></tr></tbody></table></div><iframe frameborder="0" style="position: absolute; display: none;" src="./Entity Framework之深入分析_files/saved_resource.html"></iframe><div class="jiathis_style" style="height: auto; position: absolute; z-index: 100000000; display: none; top: 50%; left: 50%; overflow: auto;"><div style="border:10px solid #7F7F7F; width:300px;"><div class="jiadiv_01" style="width:300px;"><div style="background:#F2F2F2;line-height:100%;height:30px;overflow:hidden;width:300px;"><table width="100%" style="margin:5px 0 0 0;"><tbody><tr class="jt_sharetitle" style="line-height:20px!important;"><td align="left" style="text-align:left;font-size:12px;">分享到各大网站</td><td align="right"><img src="./Entity Framework之深入分析_files/img_exit.gif" border="0" style="margin:0 4px;cursor:pointer;" onclick="$CKE.centerClose();"></td></tr></tbody></table></div><div class="searchTxtCont"><div style="background:url(http://v2.jiathis.com/code/images/img_so.gif) no-repeat center;height:30px; width:281px"><form onsubmit="return false;"><input class="searchTxt" name="" type="text" onclick="this.value=&#39;&#39;;this.style.color=&#39;#000&#39;;" value="输入网站名或拼音缩写" onkeyup="$CKE.choose(this);"></form></div></div><div id="jiathis_sharelist" class="jiadiv_02" style="width:300px;height:300px;overflow-y:auto;"><a href="javascript:;" onclick="jiathis_sendto(&#39;weixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_weixin">微信</span><input type="hidden" value="weixin,微信,wx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsina&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsina">微博</span><input type="hidden" value="tsina,微博,xlwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_cqq">QQ好友</span><input type="hidden" value="cqq,QQ好友,cqq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_qzone">QQ空间</span><input type="hidden" value="qzone,QQ空间,qqkj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;copy&#39;);return false;" class="jiatitle"><span class="jtico jtico_copy">复制网址</span><input type="hidden" value="copy,复制网址,fzwz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fav&#39;);return false;" class="jiatitle"><span class="jtico jtico_fav">收藏夹</span><input type="hidden" value="fav,收藏夹,scj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;print&#39;);return false;" class="jiatitle"><span class="jtico jtico_print">打印</span><input type="hidden" value="print,打印,dy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;email&#39;);return false;" class="jiatitle"><span class="jtico jtico_email">邮件</span><input type="hidden" value="email,邮件,yj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;renren&#39;);return false;" class="jiatitle"><span class="jtico jtico_renren">人人网</span><input type="hidden" value="renren,人人网,rrw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;kaixin001&#39;);return false;" class="jiatitle"><span class="jtico jtico_kaixin001">开心网</span><input type="hidden" value="kaixin001,开心网,kxw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;evernote&#39;);return false;" class="jiatitle"><span class="jtico jtico_evernote">印象笔记</span><input type="hidden" value="evernote,印象笔记,evernote"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;linkedin&#39;);return false;" class="jiatitle"><span class="jtico jtico_linkedin">领英</span><input type="hidden" value="linkedin,领英,linkedin"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;feixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_feixin">飞信</span><input type="hidden" value="feixin,飞信,fx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban">豆瓣</span><input type="hidden" value="douban,豆瓣,db"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;twitter&#39;);return false;" class="jiatitle"><span class="jtico jtico_twitter">Twitter</span><input type="hidden" value="twitter,Twitter,twitter"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fb&#39;);return false;" class="jiatitle"><span class="jtico jtico_fb">Facebook</span><input type="hidden" value="fb,Facebook,facebook"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ishare&#39;);return false;" class="jiatitle"><span class="jtico jtico_ishare">一键分享</span><input type="hidden" value="ishare,一键分享,yjfx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ujian&#39;);return false;" class="jiatitle"><span class="jtico jtico_ujian">猜你喜欢</span><input type="hidden" value="ujian,猜你喜欢,cnxh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;yixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_yixin">易信</span><input type="hidden" value="yixin,易信,yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;huaban&#39;);return false;" class="jiatitle"><span class="jtico jtico_huaban">花瓣网</span><input type="hidden" value="huaban,花瓣网,hbw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_tqq">腾讯微博</span><input type="hidden" value="tqq,腾讯微博,txwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;googleplus&#39;);return false;" class="jiatitle"><span class="jtico jtico_googleplus">Google+</span><input type="hidden" value="googleplus,Google+,googlej"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;alibaba&#39;);return false;" class="jiatitle"><span class="jtico jtico_alibaba">阿里巴巴</span><input type="hidden" value="alibaba,阿里巴巴,albb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;xiaoyou&#39;);return false;" class="jiatitle"><span class="jtico jtico_xiaoyou">朋友网</span><input type="hidden" value="xiaoyou,朋友网,pyw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;sdonote&#39;);return false;" class="jiatitle"><span class="jtico jtico_sdonote">麦库记事</span><input type="hidden" value="sdonote,麦库记事,mkjs"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;baidu&#39;);return false;" class="jiatitle"><span class="jtico jtico_baidu">百度搜藏</span><input type="hidden" value="baidu,百度搜藏,bdsc"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;gmail&#39;);return false;" class="jiatitle"><span class="jtico jtico_gmail">Gmail邮箱</span><input type="hidden" value="gmail,Gmail邮箱,gmailyx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ydnote&#39;);return false;" class="jiatitle"><span class="jtico jtico_ydnote">有道云笔记</span><input type="hidden" value="ydnote,有道云笔记,ydybj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tianya&#39;);return false;" class="jiatitle"><span class="jtico jtico_tianya">天涯社区</span><input type="hidden" value="tianya,天涯社区,tysq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tieba&#39;);return false;" class="jiatitle"><span class="jtico jtico_tieba">百度贴吧</span><input type="hidden" value="tieba,百度贴吧,bdtb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qingbiji&#39;);return false;" class="jiatitle"><span class="jtico jtico_qingbiji">轻笔记</span><input type="hidden" value="qingbiji,轻笔记,qbj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tifeng&#39;);return false;" class="jiatitle"><span class="jtico jtico_tifeng">凤凰微博</span><input type="hidden" value="tifeng,凤凰微博,fhwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fanfou&#39;);return false;" class="jiatitle"><span class="jtico jtico_fanfou">饭否</span><input type="hidden" value="fanfou,饭否,ff"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mingdao&#39;);return false;" class="jiatitle"><span class="jtico jtico_mingdao">明道</span><input type="hidden" value="mingdao,明道,md"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban9dian&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban9dian">豆瓣9点</span><input type="hidden" value="douban9dian,豆瓣9点,db9d"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;google&#39;);return false;" class="jiatitle"><span class="jtico jtico_google">谷歌</span><input type="hidden" value="google,谷歌,gg"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;buzz&#39;);return false;" class="jiatitle"><span class="jtico jtico_buzz">谷歌Buzz</span><input type="hidden" value="buzz,谷歌Buzz,ggbuzz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;youdao&#39;);return false;" class="jiatitle"><span class="jtico jtico_youdao">有道书签</span><input type="hidden" value="youdao,有道书签,ydsq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qq&#39;);return false;" class="jiatitle"><span class="jtico jtico_qq">QQ书签</span><input type="hidden" value="qq,QQ书签,qqsq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;msn&#39;);return false;" class="jiatitle"><span class="jtico jtico_msn">MSN</span><input type="hidden" value="msn,MSN,msn"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pinterest&#39;);return false;" class="jiatitle"><span class="jtico jtico_pinterest">Pinterest</span><input type="hidden" value="pinterest,Pinterest,pinterest"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;duitang&#39;);return false;" class="jiatitle"><span class="jtico jtico_duitang">堆糖</span><input type="hidden" value="duitang,堆糖,dt"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tyaolan&#39;);return false;" class="jiatitle"><span class="jtico jtico_tyaolan">摇篮微博</span><input type="hidden" value="tyaolan,摇篮微博,ylwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hi&#39;);return false;" class="jiatitle"><span class="jtico jtico_hi">百度空间</span><input type="hidden" value="hi,百度空间,bdkj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hotmail&#39;);return false;" class="jiatitle"><span class="jtico jtico_hotmail">Hotmail邮箱</span><input type="hidden" value="hotmail,Hotmail邮箱,hotmailyx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;xqw&#39;);return false;" class="jiatitle"><span class="jtico jtico_xqw">雪球</span><input type="hidden" value="xqw,雪球,xqw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hexun&#39;);return false;" class="jiatitle"><span class="jtico jtico_hexun">和讯</span><input type="hidden" value="hexun,和讯,hx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;139mail&#39;);return false;" class="jiatitle"><span class="jtico jtico_139mail">139邮箱</span><input type="hidden" value="139mail,139邮箱,139yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;189mail&#39;);return false;" class="jiatitle"><span class="jtico jtico_189mail">189邮箱</span><input type="hidden" value="189mail,189邮箱,189yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;189cn&#39;);return false;" class="jiatitle"><span class="jtico jtico_189cn">翼友圈</span><input type="hidden" value="189cn,翼友圈,yyq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tpeople&#39;);return false;" class="jiatitle"><span class="jtico jtico_tpeople">人民微博</span><input type="hidden" value="tpeople,人民微博,rmwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;txinhua&#39;);return false;" class="jiatitle"><span class="jtico jtico_txinhua">新华微博</span><input type="hidden" value="txinhua,新华微博,xhwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;translate&#39;);return false;" class="jiatitle"><span class="jtico jtico_translate">谷歌翻译</span><input type="hidden" value="translate,谷歌翻译,ggfy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tuita&#39;);return false;" class="jiatitle"><span class="jtico jtico_tuita">推他</span><input type="hidden" value="tuita,推他,tt"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mop&#39;);return false;" class="jiatitle"><span class="jtico jtico_mop">猫扑推客</span><input type="hidden" value="mop,猫扑推客,mptk"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;meilishuo&#39;);return false;" class="jiatitle"><span class="jtico jtico_meilishuo">美丽说</span><input type="hidden" value="meilishuo,美丽说,mls"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mogujie&#39;);return false;" class="jiatitle"><span class="jtico jtico_mogujie">蘑菇街</span><input type="hidden" value="mogujie,蘑菇街,mgj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ganniu&#39;);return false;" class="jiatitle"><span class="jtico jtico_ganniu">赶牛网</span><input type="hidden" value="ganniu,赶牛网,gnw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;poco&#39;);return false;" class="jiatitle"><span class="jtico jtico_poco">Poco网</span><input type="hidden" value="poco,Poco网,pocow"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;leihou&#39;);return false;" class="jiatitle"><span class="jtico jtico_leihou">雷猴网</span><input type="hidden" value="leihou,雷猴网,lhw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;thexun&#39;);return false;" class="jiatitle"><span class="jtico jtico_thexun">和讯微博</span><input type="hidden" value="thexun,和讯微博,hxwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;dream163&#39;);return false;" class="jiatitle"><span class="jtico jtico_dream163">游戏江湖</span><input type="hidden" value="dream163,游戏江湖,yxjh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;jcrb&#39;);return false;" class="jiatitle"><span class="jtico jtico_jcrb">法律微博</span><input type="hidden" value="jcrb,法律微博,flwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tumblr&#39;);return false;" class="jiatitle"><span class="jtico jtico_tumblr">Tumblr</span><input type="hidden" value="tumblr,Tumblr,tumblr"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;reddit&#39;);return false;" class="jiatitle"><span class="jtico jtico_reddit">Reddit</span><input type="hidden" value="reddit,Reddit,reddit"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;instapaper&#39;);return false;" class="jiatitle"><span class="jtico jtico_instapaper">Instapaper</span><input type="hidden" value="instapaper,Instapaper,instapaper"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pocket&#39;);return false;" class="jiatitle"><span class="jtico jtico_pocket">Pocket</span><input type="hidden" value="pocket,Pocket,pocket"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;caimi&#39;);return false;" class="jiatitle"><span class="jtico jtico_caimi">财迷</span><input type="hidden" value="caimi,财迷,cm"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;iwo&#39;);return false;" class="jiatitle"><span class="jtico jtico_iwo">WO+分享</span><input type="hidden" value="iwo,WO+分享,iwo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;waakee&#39;);return false;" class="jiatitle"><span class="jtico jtico_waakee">挖客网</span><input type="hidden" value="waakee,挖客网,wkw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cyzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_cyzone">创业邦</span><input type="hidden" value="cyzone,创业邦,cyb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;99earth&#39;);return false;" class="jiatitle"><span class="jtico jtico_99earth">救救地球</span><input type="hidden" value="99earth,救救地球,jjdq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;chouti&#39;);return false;" class="jiatitle"><span class="jtico jtico_chouti">抽屉网</span><input type="hidden" value="chouti,抽屉网,ctw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;dig24&#39;);return false;" class="jiatitle"><span class="jtico jtico_dig24">递客网</span><input type="hidden" value="dig24,递客网,dkw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;yijee&#39;);return false;" class="jiatitle"><span class="jtico jtico_yijee">易集网</span><input type="hidden" value="yijee,易集网,yjw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pdfonline&#39;);return false;" class="jiatitle"><span class="jtico jtico_pdfonline">Pdf在线转换</span><input type="hidden" value="pdfonline,Pdf在线转换,pdfzxzh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;printfriendly&#39;);return false;" class="jiatitle"><span class="jtico jtico_printfriendly">友好打印</span><input type="hidden" value="printfriendly,友好打印,yhdy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;w3c&#39;);return false;" class="jiatitle"><span class="jtico jtico_w3c">W3c验证</span><input type="hidden" value="w3c,W3c验证,w3cyz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;bitly&#39;);return false;" class="jiatitle"><span class="jtico jtico_bitly">Bit.ly</span><input type="hidden" value="bitly,Bit.ly,bitly"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;digg&#39;);return false;" class="jiatitle"><span class="jtico jtico_digg">Digg</span><input type="hidden" value="digg,Digg,digg"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mailru&#39;);return false;" class="jiatitle"><span class="jtico jtico_mailru">Mail.ru</span><input type="hidden" value="mailru,Mail.ru,mail.ru"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;diigo&#39;);return false;" class="jiatitle"><span class="jtico jtico_diigo">Diigo</span><input type="hidden" value="diigo,Diigo,diigo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;friendfeed&#39;);return false;" class="jiatitle"><span class="jtico jtico_friendfeed">FriendFeed</span><input type="hidden" value="friendfeed,FriendFeed,friendfeed"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;myspace&#39;);return false;" class="jiatitle"><span class="jtico jtico_myspace">Myspace</span><input type="hidden" value="myspace,Myspace,myspace"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mixx&#39;);return false;" class="jiatitle"><span class="jtico jtico_mixx">Mixx</span><input type="hidden" value="mixx,Mixx,mixx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;netlog&#39;);return false;" class="jiatitle"><span class="jtico jtico_netlog">NetLog</span><input type="hidden" value="netlog,NetLog,netlog"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;netvibes&#39;);return false;" class="jiatitle"><span class="jtico jtico_netvibes">Netvibes</span><input type="hidden" value="netvibes,Netvibes,netvibes"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;phonefavs&#39;);return false;" class="jiatitle"><span class="jtico jtico_phonefavs">Phonefavs</span><input type="hidden" value="phonefavs,Phonefavs,phonefavs"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pingfm&#39;);return false;" class="jiatitle"><span class="jtico jtico_pingfm">Ping.fm</span><input type="hidden" value="pingfm,Ping.fm,ping.fm"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;plaxo&#39;);return false;" class="jiatitle"><span class="jtico jtico_plaxo">Plaxo</span><input type="hidden" value="plaxo,Plaxo,plaxo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;delicious&#39;);return false;" class="jiatitle"><span class="jtico jtico_delicious">Delicious</span><input type="hidden" value="delicious,Delicious,delicious"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;wong&#39;);return false;" class="jiatitle"><span class="jtico jtico_wong">Mister Wong</span><input type="hidden" value="wong,Mister Wong,misterwong"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;stumbleupon&#39;);return false;" class="jiatitle"><span class="jtico jtico_stumbleupon">Stumbleupon</span><input type="hidden" value="stumbleupon,Stumbleupon,stumbleupon"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;plurk&#39;);return false;" class="jiatitle"><span class="jtico jtico_plurk">Plurk</span><input type="hidden" value="plurk,Plurk,plurk"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;funp&#39;);return false;" class="jiatitle"><span class="jtico jtico_funp">Funp</span><input type="hidden" value="funp,Funp,funp"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;myshare&#39;);return false;" class="jiatitle"><span class="jtico jtico_myshare">Myshare</span><input type="hidden" value="myshare,Myshare,myshare"></a><div style="clear:both"></div></div><div class="centerBottom"><div style="float:left;font-size:10px;"><a href="http://www.jiathis.com/help/html/what-is-jiathis" class="link_01" style="color:#333333;display:none;" target="_blank">这是什么工具?</a></div><div style="float:right;font-size:11px;margin:0 10px 0 0;"><img src="./Entity Framework之深入分析_files/img_012.gif" align="absmiddle" border="none">&nbsp;<a href="http://www.jiathis.com/index2" style="color:#333333;" class="link_01" target="_blank">JiaThis</a></div><div style="clear:both"></div></div></div></div></div><iframe frameborder="0" src="./Entity Framework之深入分析_files/jiathis_utility.html" style="display: none;"></iframe>
<a name="top"></a>

<div id="wrapper">
<div id="header">

<div id="top">
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/mecity/">小城岁月</a></h1>
<div id="subtitle">我可以记住忧伤的回忆，却依然快乐的活着。</div>
</div>
<div id="sub"><div id="blog_stats">
<div class="BlogStats">随笔 - 39, 文章 - 0, 评论 - 543, 引用 - 0</div>
</div></div>



</div>
<div id="main_container">
<div id="main_content">
<div id="content">
	
<div id="post_detail">
	<div class="post">
		<h2>
			<a id="cb_post_title_url" href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html">Entity Framework之深入分析</a>
		</h2>
		<div class="postbody">
		<div id="cnblogs_post_body" class="blogpost-body"><p>EF虽然是一个晚生畸形的ORM框架，但功能强大又具有灵活性的，给了开发人员一定的发挥空间。因为微软出发点总是好的，让开发变得简单，但实际上不是所有的事情都这么理想。这里顺便推荐马丁大叔的书《企业应架构模式》。</p>
<p>本节主要深入分析EF的分层问题，下面是本节的已列出的要探讨内容。</p>
<ul>
<li>领域模型的概念</li>
<li>DbContext与Unit of Work 的概念</li>
<li>DbContext 创建实例及线程安全问题</li>
<li>不要随便using或Dispose DbContext</li>
<li>DbContext的SaveChanges事务</li>
<li>Repository与UnitOfWork引入</li>
<li>DbContext T4模板的应用</li>
<li>EDM文件是放在DAL层还是Model层中？</li>
<li>EF MVC项目分层</li>
</ul>
<h3>一、领域模型的概念</h3>
<p>领域模型：是描述业务用例实现的对象模型。它是对业务角色和业务实体之间应该如何联系和协作以执行业务的一种抽象。 业务对象模型从业务角色内部的观点定义了业务用例。定义很商业，很抽象，也很理解。一个商业的概念被引入进来之后，引发很多争议和思考。而DomainObject&nbsp; 在我们实际的项目又演化成大致下面几种</p>
<p>1.纯事务脚本对象（只有字段的set,get)，没有任何业务（包括没有导航属性），可以以理解为贫血的领域模型。</p>
<p>2.带有自身业务的对象，例如验证业务，关联导航等。</p>
<p>3.对象包含量了大量的业务，而这些业务中并不是所有业务都和它相关。</p>
<p>尤其是第2种，界限很难划分，怎么判断这个业务是自身的，还是其它的？ 或者是否重用度高呢？ 第一种和第三种在之前的项目都使用过，目前个人觉得EF现在走的是第2种路线，EF在生成Model模型后，依然可以对模型进行业务修改。我们也不必在这样上面纠结太多，项目怎么做方便就怎么去实现。比如纯净的POCO我可以当DTO或VO使用；而第3种情况，我们在微软的DataSet时，也是大量使用的。想详细了解这段的可以参照<a href="http://www.iteye.com/topic/11712" target="_blank">这篇讨论</a></p>
<h3>二、DbContext与Unit of Work 的概念</h3>
<p>在马丁大叔中书看我们可以准看到Unit of Work 的定义：维护受业务事务影响的对象列表，并协调变化的写入和并发问题的解决。即管理对象的CRUD操作，以及相应的事务与并发问题等。Unit of Work的是用来解决领域模型存储和变更工作，而这些数据层业务并不属于领域模型本身具有的。而DbContext其实就是一个Unit of work ，只是如果直接使用这个DbContext 的话，那DbContext所有的业务都是直接暴露的，当然这是看是否项目需要了。可以看出微软的EF DbContext借用了Unit of work的思想。</p>
<h3>三、DbContext 创建实例及线程安全问题</h3>
<p>1. DbContext不适合创建成单例模式，例如A对象正在编辑，B对象编辑完了提交，导致正在编辑的A对象也被提交了，但是A的改可能要取消的，但是最终都被提交到数据库中了。</p>
<p>2. 如果DbContext创建过多的实例，就要控制好并发的问题，因为不同实例的DbContext可能会对同一条记录进行修改。</p>
<p>3. DbContext线程安全问题，同一实例的DbContext被不同线程调用会引发第一条场景的情况。不同线程使用不同实例的DbContext时又会引发第二种场景的情况。</p>
<p>第一种情况很难控制，而第二种情况可以采用乐观并发锁来解决，其次就是尽量避免对一记录的写操作。</p>
<h3>四、不要随便using或Dispose DbContext</h3>
<p>我们先来看一段代码</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;560247ed-c4a7-4e38-a6ad-2199b80104a5&#39;)"><img id="code_img_closed_560247ed-c4a7-4e38-a6ad-2199b80104a5" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif" style="display: none;"><img style="" id="code_img_opened_560247ed-c4a7-4e38-a6ad-2199b80104a5" class="code_img_opened" onclick="cnblogs_code_hide(&#39;560247ed-c4a7-4e38-a6ad-2199b80104a5&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse" style="display: none;">View Code </span>
<div id="cnblogs_code_open_560247ed-c4a7-4e38-a6ad-2199b80104a5" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #000000;">            BlogCategory cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (DemoDBEntities context </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> DemoDBEntities())<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">context.Configuration.LazyLoadingEnabled = false;</span><span style="color: #008000;"><br></span><span style="color: #000000;">                DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #0000ff;">set</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> context.Set</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br>                cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">set</span><span style="color: #000000;">.Find(</span><span style="color: #800080;">2</span><span style="color: #000000;">);   <br>            }<br><br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">肯定会出错 因为DbContext被释放了 无法延迟加载对象</span><span style="color: #008000;"><br></span><span style="color: #000000;">            BlogArticle blog </span><span style="color: #000000;">=</span><span style="color: #000000;"> cate.BlogArticle.First();</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<p>当我们在使用延迟加载的时候，如果使用using或dispose 释放掉DbContext后，就无法延迟加载导航属性。为什么？我们来看一下DbContext是如何加载对象以及导航属性的。</p>
<p>将上面的代码修改一下</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;f5fa7eb3-6b34-400d-9df1-984a7ccd9788&#39;)"><img id="code_img_closed_f5fa7eb3-6b34-400d-9df1-984a7ccd9788" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif" style="display: none;"><img style="" id="code_img_opened_f5fa7eb3-6b34-400d-9df1-984a7ccd9788" class="code_img_opened" onclick="cnblogs_code_hide(&#39;f5fa7eb3-6b34-400d-9df1-984a7ccd9788&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse" style="display: none;">View Code </span>
<div id="cnblogs_code_open_f5fa7eb3-6b34-400d-9df1-984a7ccd9788" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Main(</span><span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)<br>        {<br>            BlogCategory cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (DemoDBEntities context </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> DemoDBEntities())<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">context.Configuration.LazyLoadingEnabled = false;</span><span style="color: #008000;"><br></span><span style="color: #000000;">                DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #0000ff;">set</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> context.Set</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br>                cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">set</span><span style="color: #000000;">.Find(</span><span style="color: #800080;">2</span><span style="color: #000000;">);<br><br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">肯定会出错 因为DbContext被释放了 无法延迟加载对象</span><span style="color: #008000;"><br></span><span style="color: #000000;">                BlogArticle blog </span><span style="color: #000000;">=</span><span style="color: #000000;"> cate.BlogArticle.First();<br>            }<br>           <br>            Console.ReadLine();           <br>        }</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<p>我们打开SQL Server Profiler 来监视一上面的代码执行情况</p>
<p>&nbsp;<img alt="" src="./Entity Framework之深入分析_files/2011071714274390.png"></p>
<p>可以看如果DbContext如果在第一次读取BlogCategory被释放后，那在加载导航属性的时候肯定不会执行成功。</p>
<p><span style="color: #ff0000;">另外一点：为什么很多人一定要using 或dispose掉DbContext ?</span></p>
<p>是担心数据库连接没有释放？还是担心DbContext占用过多资源呢？</p>
<p>首先担心数据库连接没有释放肯定是多余的，因为DbContext在SaveChanges完成后会释放掉打开的数据库连接，我们来反编译一下SaveChages的源码看看</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;142f05a8-8766-4265-b768-7fea16812192&#39;)"><img id="code_img_closed_142f05a8-8766-4265-b768-7fea16812192" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif"><img style="display: none;" id="code_img_opened_142f05a8-8766-4265-b768-7fea16812192" class="code_img_opened" onclick="cnblogs_code_hide(&#39;142f05a8-8766-4265-b768-7fea16812192&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_142f05a8-8766-4265-b768-7fea16812192" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">virtual</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> SaveChanges(SaveOptions options)<br>{<br>    </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.OnSavingChanges();<br>    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> ((SaveOptions.DetectChangesBeforeSave </span><span style="color: #000000;">&amp;</span><span style="color: #000000;"> options) </span><span style="color: #000000;">!=</span><span style="color: #000000;"> SaveOptions.None)<br>    {<br>        </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.ObjectStateManager.DetectChanges();<br>    }<br>    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.ObjectStateManager.SomeEntryWithConceptualNullExists())<br>    {<br>        </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> InvalidOperationException(Strings.ObjectContext_CommitWithConceptualNull);<br>    }<br>    </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> objectStateEntriesCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.ObjectStateManager.GetObjectStateEntriesCount(EntityState.Modified </span><span style="color: #000000;">|</span><span style="color: #000000;"> EntityState.Deleted </span><span style="color: #000000;">|</span><span style="color: #000000;"> EntityState.Added);<br>    </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> EntityBid.ScopeAuto(</span><span style="color: #800000;">"</span><span style="color: #800000;">&lt;dobj.ObjectContext.SaveChanges|API&gt; %d#, affectingEntries=%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.ObjectID, objectStateEntriesCount))<br>    {<br>        EntityConnection connection </span><span style="color: #000000;">=</span><span style="color: #000000;"> (EntityConnection) </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Connection;<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #800080;">0</span><span style="color: #000000;"> </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> objectStateEntriesCount)<br>        {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> objectStateEntriesCount;<br>        }<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">this</span><span style="color: #000000;">._adapter </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>        {<br>            IServiceProvider providerFactory </span><span style="color: #000000;">=</span><span style="color: #000000;"> connection.ProviderFactory </span><span style="color: #0000ff;">as</span><span style="color: #000000;"> IServiceProvider;<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (providerFactory </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">._adapter </span><span style="color: #000000;">=</span><span style="color: #000000;"> providerFactory.GetService(</span><span style="color: #0000ff;">typeof</span><span style="color: #000000;">(IEntityAdapter)) </span><span style="color: #0000ff;">as</span><span style="color: #000000;"> IEntityAdapter;<br>            }<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">this</span><span style="color: #000000;">._adapter </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> EntityUtil.InvalidDataAdapter();<br>            }<br>        }<br>        </span><span style="color: #0000ff;">this</span><span style="color: #000000;">._adapter.AcceptChangesDuringUpdate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">this</span><span style="color: #000000;">._adapter.Connection </span><span style="color: #000000;">=</span><span style="color: #000000;"> connection;<br>        </span><span style="color: #0000ff;">this</span><span style="color: #000000;">._adapter.CommandTimeout </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.CommandTimeout;<br>        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"><br>        {<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.EnsureConnection();<br>            flag </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>            Transaction current </span><span style="color: #000000;">=</span><span style="color: #000000;"> Transaction.Current;<br>            </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> flag2 </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (connection.CurrentTransaction </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>            {<br>                flag2 </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #0000ff;">this</span><span style="color: #000000;">._lastTransaction;<br>            }<br>            </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (DbTransaction transaction </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (flag2)<br>                {<br>                    transaction </span><span style="color: #000000;">=</span><span style="color: #000000;"> connection.BeginTransaction();<br>                }<br>                objectStateEntriesCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">this</span><span style="color: #000000;">._adapter.Update(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.ObjectStateManager);<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (transaction </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                {<br>                    transaction.Commit();<br>                }<br>            }<br>        }<br>        </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"><br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (flag)<br>            {<br>                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.ReleaseConnection();<br>            }<br>        }<br>        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> ((SaveOptions.AcceptAllChangesAfterSave </span><span style="color: #000000;">&amp;</span><span style="color: #000000;"> options) </span><span style="color: #000000;">==</span><span style="color: #000000;"> SaveOptions.None)<br>        {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> objectStateEntriesCount;<br>        }<br>        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"><br>        {<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.AcceptAllChanges();<br>        }<br>        </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception exception)<br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (EntityUtil.IsCatchableExceptionType(exception))<br>            {<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> EntityUtil.AcceptAllChangesFailure(exception);<br>            }<br>            </span><span style="color: #0000ff;">throw</span><span style="color: #000000;">;<br>        }<br>    }<br>    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> objectStateEntriesCount;<br>}<br><br> </span></pre>
</div>
</div>
<p>可以看到DbContext 每次打开&nbsp; <span style="color: #000000;"><span style="color: #000000;">EntityConnection</span>&nbsp;</span><b> </b>&nbsp;最后都会&nbsp;<span style="color: #1000a0;" color="#1000a0">finally</span> 时 通过<span style="color: #1000a0;" color="#1000a0">this</span>.ReleaseConnection() 释放掉连接，所以这个担心是多余的。</p>
<p>其次DbContext 是否占用过多的资源呢？DbContext确实占用了资源，主要体现在DbContext的Local属性上，每一次的增删改查，Loacl都会从数据库中加载数据，而这些数据在SaveChanges之后并没有释放掉。因此释放DbContext 是需要的，但是这样又会影响到延迟加载。这样的话，我们可以通过重载SaveChanges，在SaveChanges之后清除掉Local中的数据。但是这样做为什么有问题，我也不知道，有待考证。上一节中有介绍重载SaveChanges 清除Local 数据阻止查询数据更新。&nbsp;</p>
<h3>五、DbContext的SaveChanges自带事务与分布式事务</h3>
<p>通过反编译可以看到单实例DbContext的SaveChanges方式默认开启了事务，当同时更新多条记录时，有一条失败就会RollBack。模拟测试代码</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c98992a1-5c3d-4f16-9856-ada2722ff1eb&#39;)"><img id="code_img_closed_c98992a1-5c3d-4f16-9856-ada2722ff1eb" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif" style="display: none;"><img style="" id="code_img_opened_c98992a1-5c3d-4f16-9856-ada2722ff1eb" class="code_img_opened" onclick="cnblogs_code_hide(&#39;c98992a1-5c3d-4f16-9856-ada2722ff1eb&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse" style="display: none;">View Code </span>
<div id="cnblogs_code_open_c98992a1-5c3d-4f16-9856-ada2722ff1eb" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Linq;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> EF.Model;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> EF.DAL;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.Entity;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Transactions;<br></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> EF.Demo<br>{<br>    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Program<br>    {<br>        </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Main(</span><span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)<br>        {<br>            BlogCategory cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>            DemoDBEntities context </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> DemoDBEntities();<br><br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">DemoDBEntities context2 = new DemoDBEntities();</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">try</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">using (TransactionScope scope = new TransactionScope())<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">{<br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">context.Configuration.LazyLoadingEnabled = false;</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #0000ff;">set</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> context.Set</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br><br>                    cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> BlogCategory();<br>                    cate.CateName </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">"</span><span style="color: #800000;">2010-7</span><span style="color: #800000;">"</span><span style="color: #000000;">;<br>                    cate.CreateTime </span><span style="color: #000000;">=</span><span style="color: #000000;"> DateTime.Now;<br><br>                    cate.BlogArticle.Add(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> BlogArticle() { Title </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">"</span><span style="color: #800000;">2011-7-15</span><span style="color: #800000;">"</span><span style="color: #000000;"> });<br>                    </span><span style="color: #0000ff;">set</span><span style="color: #000000;">.Add(cate);<br><br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">由于没设置Title字段,并且CreateTime字段不能为空，故会引发异常</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    context.Set</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogArticle</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">().Add(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> BlogArticle { BlogCategory_CateID </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;"> });<br>                    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> a </span><span style="color: #000000;">=</span><span style="color: #000000;"> context.SaveChanges();<br><br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">    context2.Set&lt;BlogArticle&gt;().Add(new BlogArticle { BlogCategory_CateID = 2 });<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">    int b = context2.SaveChanges();<br><br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">    scope.Complete();<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">}</span><span style="color: #008000;"><br></span><span style="color: #000000;">            }<br>            </span><span style="color: #0000ff;">catch</span><span style="color: #000000;">(Exception ex)<br>            {<br>                Console.WriteLine(ex.Message);<br>            }<br>            <br><br>            Console.ReadLine();           <br>        }<br>    }    <br>}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<p>通过SQL SERVER Profile 监视到没有一句SQL语句被执行，SaveChanges事务是预执新所有操作成功后才会更新到数据库中。</p>
<p>我们再来测试一下分布式事务，创建的Context2用于模拟代表其它数据库</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;bdd4ef88-b3c1-4aed-8d9b-5311f590cc8f&#39;)"><img id="code_img_closed_bdd4ef88-b3c1-4aed-8d9b-5311f590cc8f" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif" style="display: none;"><img style="" id="code_img_opened_bdd4ef88-b3c1-4aed-8d9b-5311f590cc8f" class="code_img_opened" onclick="cnblogs_code_hide(&#39;bdd4ef88-b3c1-4aed-8d9b-5311f590cc8f&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse" style="display: none;">View Code </span>
<div id="cnblogs_code_open_bdd4ef88-b3c1-4aed-8d9b-5311f590cc8f" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Linq;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> EF.Model;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> EF.DAL;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.Entity;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Transactions;<br></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> EF.Demo<br>{<br>    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Program<br>    {<br>        </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Main(</span><span style="color: #0000ff;">string</span><span style="color: #000000;">[] args)<br>        {<br>            BlogCategory cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>            DemoDBEntities context </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> DemoDBEntities();<br><br>            DemoDBEntities context2 </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> DemoDBEntities();<br>            </span><span style="color: #0000ff;">try</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> (TransactionScope scope </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> TransactionScope())<br>                {<br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">context.Configuration.LazyLoadingEnabled = false;</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #0000ff;">set</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> context.Set</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br><br>                    cate </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> BlogCategory();<br>                    cate.CateName </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">"</span><span style="color: #800000;">2010-7</span><span style="color: #800000;">"</span><span style="color: #000000;">;<br>                    cate.CreateTime </span><span style="color: #000000;">=</span><span style="color: #000000;"> DateTime.Now;<br><br>                    cate.BlogArticle.Add(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> BlogArticle() { Title </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">"</span><span style="color: #800000;">2011-7-15</span><span style="color: #800000;">"</span><span style="color: #000000;"> });<br>                    </span><span style="color: #0000ff;">set</span><span style="color: #000000;">.Add(cate);<br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">实例1 对数据库执行提交</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> a </span><span style="color: #000000;">=</span><span style="color: #000000;"> context.SaveChanges();<br><br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">实例2 模拟其它数据库提交 时间字段为空，无法更新成功</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    context2.Set</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogArticle</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">().Add(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> BlogArticle { Title</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">2011-7-16</span><span style="color: #800000;">"</span><span style="color: #000000;">, BlogCategory_CateID </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;"> });<br>                    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> b </span><span style="color: #000000;">=</span><span style="color: #000000;"> context2.SaveChanges();<br><br>                    scope.Complete();<br>                }<br>            }<br>            </span><span style="color: #0000ff;">catch</span><span style="color: #000000;">(Exception ex)<br>            {<br>                Console.WriteLine(ex.Message);<br>            }<br>            <br><br>            Console.ReadLine();           <br>        }<br>    }    <br>}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Entity Framework之深入分析_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<p>通过SQL SERVER Profile 监视，虽然context实际执行了两条SQL记录，但是context2的SQL没有执行成功，导致事务回滚，所有操作都被没有执行成功。&nbsp;</p>
<h3>六、Repository与UnitOfWork引入</h3>
<p>Repository是什么？ 马丁大叔的书上同样也有解释：它是衔接数据映射层和域之间的一个纽带，作用相当于一个在内存中的域对象映射集合，它分离了领域对象和数据库访问代码的细节。Repository受DomainObject驱动，Repository用于实现不属于DomainObject的自身相关的，但又受DomainObject约束的业务。如CRUD操作就不是领域模型要关注的业务，但是领域模型最终要映射为数据关系保存到数据库中。一个领域模型要有对应的Repository来处理与数据层衔接过程。但不是所有的DomainObject对Repository约束是相同的，可能这个领域对象没有对应Repository删除操作，而别外一个却有，所以我们经常使用的泛型Repository&lt;T&gt; 是不合适的。但是为了代码简洁重用，大家根据实际情况还是使用了简洁的IRepository&lt;T&gt;接口，就像我们有时为了简单直接把POCO当DTO或VO使用了。如果不引入Repository，我觉得没有必要实现DAL层，因为DbContext本身就是DAL层，然后只要为DbContext定义好接IDAL接口从而必免与BLL层的耦合。从这里就可以看出Repository与DAL的区别，一个受域业务驱动出现的，一个是出于解除耦合出现的。</p>
<p>UnitOfWork 工作单元，前面已经介绍过。为了减少业务层频繁调用DbContext的SaveChanges同步数据库操作（将多个对象的更新一次提交，减少与数据库交互过程），又要保证DbContext对业务层封闭，所以我们要增加一个对业务层开放的接口。想一想如果把SaveChanges的方法下放到每个Repository中或者DAL中，那业务层在协调多个Repository事务操作时，就会频繁的写数据库。而分离了Repository中的所有SaveChanges&nbsp;（或者撤销以及完成单元工作后销毁等操作）后，并通过接口在业务层统一调用，这样既大大提高了效率，也体现了一个完整的单元工作业务。</p>
<h3>七、DbContext T4模板的应用</h3>
<p>在Model First中，我们借助于EDMX 和T4模板完成了DbContext和Model的初步设计。但是微软提供的这些模板不能满足用户的所有需求，这个时候我就要修改T4 来生成我们想要的代码。</p>
<p>T4模板应用非常广泛，很多ORM工具的模板也在使用的T4模板，T4也可以生成HTML，JS等多种语言。T4模板支持多种语言书写，可读性很强，也容易上手。</p>
<p>DbContext模板 一共分为两个 DemoDB.DbContext.tt （unit of work)和DemoDb.tt (model) 。前一节我们介绍了如何修改DemoDb.tt 模板 使我们POCO模型继承POCOEntity，这一节再修改一下DemoDb.DbContext.tt模板 使其继承IUnitOfWork接口。&nbsp;</p>
<p>首先我们在Model层中增加IUnitOfWork接口如下</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;3f2d3116-9632-4ba4-9e88-63e1dc2ce536&#39;)"><img id="code_img_closed_3f2d3116-9632-4ba4-9e88-63e1dc2ce536" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif"><img style="display: none;" id="code_img_opened_3f2d3116-9632-4ba4-9e88-63e1dc2ce536" class="code_img_opened" onclick="cnblogs_code_hide(&#39;3f2d3116-9632-4ba4-9e88-63e1dc2ce536&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_3f2d3116-9632-4ba4-9e88-63e1dc2ce536" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Linq;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;<br><br></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> EF.Model<br>{<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">interface</span><span style="color: #000000;"> IUnitOfWork<br>    {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">事务提交</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> Save();   <br>    }<br>}</span></pre>
</div>
</div>
<p>我们再修改DemoDb.DbContext.tt模板</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;087ee56c-12de-4f0e-8f48-b8e3f6fc61ca&#39;)"><img id="code_img_closed_087ee56c-12de-4f0e-8f48-b8e3f6fc61ca" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif"><img style="display: none;" id="code_img_opened_087ee56c-12de-4f0e-8f48-b8e3f6fc61ca" class="code_img_opened" onclick="cnblogs_code_hide(&#39;087ee56c-12de-4f0e-8f48-b8e3f6fc61ca&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_087ee56c-12de-4f0e-8f48-b8e3f6fc61ca" class="cnblogs_code_hide">
<pre><span style="color: #000000;">&lt;</span><span style="color: #000000;">#@ template language</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">C#</span><span style="color: #800000;">"</span><span style="color: #000000;"> debug</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">false</span><span style="color: #800000;">"</span><span style="color: #000000;"> hostspecific</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">true</span><span style="color: #800000;">"</span><span style="color: #000000;">#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br></span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#@ include file</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">EF.Utility.CS.ttinclude</span><span style="color: #800000;">"</span><span style="color: #000000;">#</span><span style="color: #000000;">&gt;&lt;</span><span style="color: #000000;">#@<br> output extension</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">.cs</span><span style="color: #800000;">"</span><span style="color: #000000;">#</span><span style="color: #000000;">&gt;&lt;</span><span style="color: #000000;">#<br><br>var loader </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> MetadataLoader(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">);<br>var region </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> CodeRegion(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------这里导入了DemoDB.edmx映射文件---------------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #000000;">var inputFile </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">@"</span><span style="color: #800000;">DemoDB.edmx</span><span style="color: #800000;">"</span><span style="color: #000000;">;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------映射文件转为集合方便模板篇历生成代码--------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #000000;">var ItemCollection </span><span style="color: #000000;">=</span><span style="color: #000000;"> loader.CreateEdmItemCollection(inputFile);<br><br>Code </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> CodeGenerationTools(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">);<br>EFTools </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> MetadataTools(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">);<br>ObjectNamespace </span><span style="color: #000000;">=</span><span style="color: #000000;"> Code.VsNamespaceSuggestion();<br>ModelNamespace </span><span style="color: #000000;">=</span><span style="color: #000000;"> loader.GetModelNamespace(inputFile);<br><br>EntityContainer container </span><span style="color: #000000;">=</span><span style="color: #000000;"> ItemCollection.GetItems</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">EntityContainer</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">().FirstOrDefault();<br></span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (container </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>{<br>    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Empty;<br>}<br>#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br></span><span style="color: #008000;">//</span><span style="color: #008000;">------------------------------------------------------------------------------<br></span><span style="color: #008000;">//</span><span style="color: #008000;"> &lt;auto-generated&gt;<br></span><span style="color: #008000;">//</span><span style="color: #008000;"> &lt;#=GetResourceString("Template_GeneratedCodeCommentLine1")#&gt;<br></span><span style="color: #008000;">//</span><span style="color: #008000;"><br></span><span style="color: #008000;">//</span><span style="color: #008000;"> &lt;#=GetResourceString("Template_GeneratedCodeCommentLine2")#&gt;<br></span><span style="color: #008000;">//</span><span style="color: #008000;"> &lt;#=GetResourceString("Template_GeneratedCodeCommentLine3")#&gt;<br></span><span style="color: #008000;">//</span><span style="color: #008000;"> &lt;/auto-generated&gt;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">------------------------------------------------------------------------------</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br></span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#<br><br></span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">String.IsNullOrEmpty(ObjectNamespace))<br>{<br>#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#</span><span style="color: #000000;">=</span><span style="color: #000000;">Code.EscapeNamespace(ObjectNamespace)#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>{<br></span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#<br>    PushIndent(CodeRegion.GetIndent(</span><span style="color: #800080;">1</span><span style="color: #000000;">));<br>}<br><br>#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.Entity;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.Entity.Infrastructure;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------这加加入对EF.Model命名空间的引用---------------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> EF.Model;<br></span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#<br></span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (container.FunctionImports.Any())<br>{<br>#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.Objects;<br></span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#<br>}<br>#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br><br></span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------这里加入对IUnitOfWork接口继承---------------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#</span><span style="color: #000000;">=</span><span style="color: #000000;">Accessibility.ForType(container)#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #0000ff;">partial</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#</span><span style="color: #000000;">=</span><span style="color: #000000;">Code.Escape(container)#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> : DbContext,IUnitOfWork<br>{<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#</span><span style="color: #000000;">=</span><span style="color: #000000;">Code.Escape(container)#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">()<br>        : </span><span style="color: #0000ff;">base</span><span style="color: #000000;">(</span><span style="color: #800000;">"</span><span style="color: #800000;">name=&lt;#=container.Name#&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">)<br>    {<br></span><span style="color: #000000;">&lt;</span><span style="color: #000000;">#<br>        WriteLazyLoadingEnabled(container);<br>#</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>    }    <br><br>    </span><span style="color: #0000ff;">protected</span><span style="color: #000000;"> </span><span style="color: #0000ff;">override</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> OnModelCreating(DbModelBuilder modelBuilder)<br>    {<br>        </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> UnintentionalCodeFirstException();<br>    }<br>    <br>    </span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------这里加入对IUnitOfWork接口方法的实现---------------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #000000;">    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> Save()<br>    {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">base</span><span style="color: #000000;">.SaveChanges();<br>    }</span></pre>
</div>
</div>
<p>注意T4模板中加了注释的地方，保存模板后，就会重新创建DemoDBEntities，看一下模板修改后生成后的代码</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;e1df18be-5789-427e-bb09-5617b801f766&#39;)"><img id="code_img_closed_e1df18be-5789-427e-bb09-5617b801f766" class="code_img_closed" src="./Entity Framework之深入分析_files/ContractedBlock.gif"><img style="display: none;" id="code_img_opened_e1df18be-5789-427e-bb09-5617b801f766" class="code_img_opened" onclick="cnblogs_code_hide(&#39;e1df18be-5789-427e-bb09-5617b801f766&#39;,event)" src="./Entity Framework之深入分析_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_e1df18be-5789-427e-bb09-5617b801f766" class="cnblogs_code_hide">
<pre><span style="color: #008000;">//</span><span style="color: #008000;">------------------------------------------------------------------------------<br></span><span style="color: #008000;">//</span><span style="color: #008000;"> &lt;auto-generated&gt;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">    此代码是根据模板生成的。<br></span><span style="color: #008000;">//</span><span style="color: #008000;"><br></span><span style="color: #008000;">//</span><span style="color: #008000;">    手动更改此文件可能会导致应用程序中发生异常行为。<br></span><span style="color: #008000;">//</span><span style="color: #008000;">    如果重新生成代码，则将覆盖对此文件的手动更改。<br></span><span style="color: #008000;">//</span><span style="color: #008000;"> &lt;/auto-generated&gt;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">------------------------------------------------------------------------------</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> EF.DAL<br>{<br>    </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br>    </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.Entity;<br>    </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data.Entity.Infrastructure;<br>    </span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------这加加入对EF.Model命名空间的引用---------------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #000000;">    </span><span style="color: #0000ff;">using</span><span style="color: #000000;"> EF.Model;<br>    <br>    </span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------这里加入对IUnitOfWork接口继承---------------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #000000;">    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">partial</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> DemoDBEntities : DbContext,IUnitOfWork<br>    {<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DemoDBEntities()<br>            : </span><span style="color: #0000ff;">base</span><span style="color: #000000;">(</span><span style="color: #800000;">"</span><span style="color: #800000;">name=DemoDBEntities</span><span style="color: #800000;">"</span><span style="color: #000000;">)<br>        {<br>        }    <br>    <br>        </span><span style="color: #0000ff;">protected</span><span style="color: #000000;"> </span><span style="color: #0000ff;">override</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> OnModelCreating(DbModelBuilder modelBuilder)<br>        {<br>            </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> UnintentionalCodeFirstException();<br>        }<br>        <br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">---------------------------------------------------这里加入对IUnitOfWork接口方法的实现---------------add by mecity</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> Save()<br>        {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">base</span><span style="color: #000000;">.SaveChanges();<br>        }<br>    <br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogArticle</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> BlogArticle { </span><span style="color: #0000ff;">get</span><span style="color: #000000;">; </span><span style="color: #0000ff;">set</span><span style="color: #000000;">; }<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogCategory</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> BlogCategory { </span><span style="color: #0000ff;">get</span><span style="color: #000000;">; </span><span style="color: #0000ff;">set</span><span style="color: #000000;">; }<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogComment</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> BlogComment { </span><span style="color: #0000ff;">get</span><span style="color: #000000;">; </span><span style="color: #0000ff;">set</span><span style="color: #000000;">; }<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogDigg</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> BlogDigg { </span><span style="color: #0000ff;">get</span><span style="color: #000000;">; </span><span style="color: #0000ff;">set</span><span style="color: #000000;">; }<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogTag</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> BlogTag { </span><span style="color: #0000ff;">get</span><span style="color: #000000;">; </span><span style="color: #0000ff;">set</span><span style="color: #000000;">; }<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DbSet</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">BlogMaster</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> BlogMaster { </span><span style="color: #0000ff;">get</span><span style="color: #000000;">; </span><span style="color: #0000ff;">set</span><span style="color: #000000;">; }<br>    }<br>}</span></pre>
</div>
</div>
<h3>八、EDM文件是放在DAL层还是Model层中？</h3>
<p>记得我第一篇EF介绍中将EDMX文件和Model放在一起，这样做有一定风险，按照领域模型的概念，Model中这些业务对象被修改的可能性非常高，并且每个业务对象的修改的业务都可能不同，因此修改DemoDB.tt模板满足所有对象是不实现的， 并且意外保存EDMX文件时，也会导致Model手动修改的内容丢失。因此EDMX不适合和Model放在一起，最好移至到DAL层或Repository层。DAL中的DemoDb.DbContext.tt模板生成代码是相对固定的（只有一个DemoDBEntities类），因此对DemoDb.DbContext.tt模板的修改基本可以满足要求。见上节T4应用。我们可以先在DAL中的EDMX完成POCO对象的初步生成与映射关系工作后，再移至到Model中处理。</p>
<h3>九、EF MVC项目分层&nbsp;</h3>
<p>就目前CodePlex上的微软项目NorthwindPoco/Oxite/Oxite2）以及其它开源的.net mvc EF项目分层来看，大致结构如下</p>
<p>View&nbsp;&nbsp; 视图</p>
<p>Controller 控制器</p>
<p>IService&nbsp; Controller调用具体业务的接口</p>
<p>Service&nbsp;&nbsp; IService的具体实现 ，利用IOC注入到Controller</p>
<p>Repository 是IRepository&nbsp;的具体实现，利用IOC注入到Service</p>
<p>Model+IRepository&nbsp; 因为IRepository接口对应的是DoaminModel约束业务，并且都是直接开放给Service&nbsp;调用的，所以放在一个类库下也容易理解，当然分开也无影响。</p>
<p>VO/DTO&nbsp; ViewObject与DTO 传输对象类库</p>
<p>当然这只是参考，怎么合理分层还是依项目需求，项目进度，资源情况以及后期维护等情况而定。</p>
<p></p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory">分类: <a href="http://www.cnblogs.com/mecity/category/304877.html" target="_blank">Entity Framework</a></div>
<div id="EntryTag">标签: <a href="http://www.cnblogs.com/mecity/tag/.net%20mvc/">.net mvc</a>, <a href="http://www.cnblogs.com/mecity/tag/EntityFramework/">EntityFramework</a></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(2108508,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;61e274ad-e258-df11-ba8f-001cf0cd104b&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./Entity Framework之深入分析_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./Entity Framework之深入分析_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/mecity/" target="_blank"><img src="./Entity Framework之深入分析_files/u131283.jpg" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/mecity/">小城岁月</a><br>
            <a href="http://home.cnblogs.com/u/mecity/followees">关注 - 30</a><br>
            <a href="http://home.cnblogs.com/u/mecity/followers">粉丝 - 487</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;61e274ad-e258-df11-ba8f-001cf0cd104b&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(2108508,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">37</span>
    </div>
    <div class="buryit" onclick="votePost(2108508,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">1</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
</div>
<div class="clear"></div>
<div id="post_next_prev"><a href="http://www.cnblogs.com/mecity/archive/2011/07/11/2102475.html" class="p_n_p_prefix">« </a> 上一篇：<a href="http://www.cnblogs.com/mecity/archive/2011/07/11/2102475.html" title="发布于2011-07-11 14:00">Entity Framework之查询总结</a><br><a href="http://www.cnblogs.com/mecity/archive/2011/07/20/2112133.html" class="p_n_p_prefix">» </a> 下一篇：<a href="http://www.cnblogs.com/mecity/archive/2011/07/20/2112133.html" title="发布于2011-07-20 22:26">项目铺垫系列导航目录</a><br></div>
</div>


		</div>
		<p class="postfoot">
			posted on <span id="post-date">2011-07-17 22:24</span> <a href="http://www.cnblogs.com/mecity/">小城岁月</a> 阅读(<span id="post_view_count">39766</span>) 评论(<span id="post_comment_count">54</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=2108508" rel="nofollow">编辑</a> <a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#" onclick="AddToWz(2108508);return false;">收藏</a>
		</p>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=90810,cb_entryId=2108508,cb_blogApp=currentBlogApp,cb_blogUserGuid='61e274ad-e258-df11-ba8f-001cf0cd104b',cb_entryCreatedDate='2011/7/17 22:24:00';loadViewCount(cb_entryId);var cb_postType=1;</script>
	
	</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"><div class="pager"><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#!comments" onclick="commentManager.renderComments(1,50);return false;">&lt; Prev</a><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#!comments" onclick="commentManager.renderComments(1,50);return false;">1</a><span class="current">2</span></div></div>
<a name="评论"></a>
<div id="comments">
<h3>评论</h3>
	
	
			<div class="post">
				<h2>
					<a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#3424118" class="layer">#51楼</a><a name="3424118" id="comment_anchor_3424118"></a>
					&nbsp;&nbsp;<span class="comment_actions"><a href="javascript:void(0);" onclick="return ReplyComment(3424118,&#39;3AecvBqdrNw3UMRIHEIaJsfRGYrdM/argq7pTlNnjui/Y3zYPrYX2A==&#39;)">回复</a><a href="javascript:void(0);" onclick="return QuoteComment(3424118,&#39;3AecvBqdrNw3UMRIHEIaJsfRGYrdM/argq7pTlNnjui/Y3zYPrYX2A==&#39;)">引用</a></span>
				</h2>
				<div id="comment_body_3424118" class="blog_comment_body">如果把ef放到dal层，那么，显示层如果要使用模型如list&lt;model&gt;,那么要引用dal层？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3424118,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3424118,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3424118_avatar" style="display:none;">http://pic.cnblogs.com/face/821102/20170207093032.png</span>
				<div class="postfoot">
					 <span class="comment_date">2016-05-06 11:08</span> | <a id="a_comment_author_3424118" href="http://www.cnblogs.com/tanl/" target="_blank">胡正</a> <a href="http://msg.cnblogs.com/send/%E8%83%A1%E6%AD%A3" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
				</div>
			</div>
		
			<div class="post">
				<h2>
					<a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#3475380" class="layer">#52楼</a><a name="3475380" id="comment_anchor_3475380"></a>
					&nbsp;&nbsp;<span class="comment_actions"><a href="javascript:void(0);" onclick="return ReplyComment(3475380,&#39;L7/5RC7zJlcIgNpFTOAb3AB2uC72Os/kOexec3ss3G2B+G1afDLYJA==&#39;)">回复</a><a href="javascript:void(0);" onclick="return QuoteComment(3475380,&#39;L7/5RC7zJlcIgNpFTOAb3AB2uC72Os/kOexec3ss3G2B+G1afDLYJA==&#39;)">引用</a></span>
				</h2>
				<div id="comment_body_3475380" class="blog_comment_body">此文，探到跟多EF的原理及其框架设计后如何更好的使用。对我这种新手，确实很难吃透。留下记号。以后渗入研究一下。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3475380,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3475380,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3475380_avatar" style="display:none;">http://pic.cnblogs.com/face/u57672.jpg</span>
				<div class="postfoot">
					 <span class="comment_date">2016-07-23 16:44</span> | <a id="a_comment_author_3475380" href="http://www.cnblogs.com/edzjx/" target="_blank">伊一线天</a> <a href="http://msg.cnblogs.com/send/%E4%BC%8A%E4%B8%80%E7%BA%BF%E5%A4%A9" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
				</div>
			</div>
		
			<div class="post">
				<h2>
					<a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#3550985" class="layer">#53楼</a><a name="3550985" id="comment_anchor_3550985"></a>
					&nbsp;&nbsp;<span class="comment_actions"><a href="javascript:void(0);" onclick="return ReplyComment(3550985,&#39;jjDpZho6lO//jktfvQ9K9Rd3XdW7zAQfqdXeMDtIoppTPzrdZ8s3iA==&#39;)">回复</a><a href="javascript:void(0);" onclick="return QuoteComment(3550985,&#39;jjDpZho6lO//jktfvQ9K9Rd3XdW7zAQfqdXeMDtIoppTPzrdZ8s3iA==&#39;)">引用</a></span>
				</h2>
				<div id="comment_body_3550985" class="blog_comment_body">咨询博主一个问题。<br>当savechanges的时候会释放资源， <br>我查看了find的源码。 没有找到相关释放dbcontext的代码，  <br>那么当find的时候  ，每次都要手动的释放资源么？  还是有自动处理的机制呢？  <br><br>Set&lt;TEntity&gt;().Find()</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3550985,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3550985,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3550985_avatar" style="display:none;">http://pic.cnblogs.com/face/u260778.jpg?id=16171811</span>
				<div class="postfoot">
					 <span class="comment_date">2016-11-08 11:23</span> | <a id="a_comment_author_3550985" href="http://www.cnblogs.com/newer/" target="_blank">刘剑_1989</a> <a href="http://msg.cnblogs.com/send/%E5%88%98%E5%89%91_1989" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
				</div>
			</div>
		
			<div class="post">
				<h2>
					<a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#3629222" class="layer">#54楼</a><a name="3629222" id="comment_anchor_3629222"></a><span id="comment-maxId" style="display:none;">3629222</span><span id="comment-maxDate" style="display:none;">2017/3/1 15:11:08</span>
					&nbsp;&nbsp;<span class="comment_actions"><a href="javascript:void(0);" onclick="return ReplyComment(3629222,&#39;w/MukDkWq7ZIdY6QmAX6o+3pBs+CXxyqpVi6oWPOdxBio5luFDuRoQ==&#39;)">回复</a><a href="javascript:void(0);" onclick="return QuoteComment(3629222,&#39;w/MukDkWq7ZIdY6QmAX6o+3pBs+CXxyqpVi6oWPOdxBio5luFDuRoQ==&#39;)">引用</a></span>
				</h2>
				<div id="comment_body_3629222" class="blog_comment_body"><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#3550985" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3550985);">@</a>
刘剑_1989<br>不能释放的，还有导航属性</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3629222,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3629222,&#39;Bury&#39;,this)">反对(0)</a></div>
				<div class="postfoot">
					 <span class="comment_date">2017-03-01 15:11</span> | <a id="a_comment_author_3629222" href="http://home.cnblogs.com/u/1030515/" target="_blank">jvCrystal</a> <a href="http://msg.cnblogs.com/send/jvCrystal" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
				</div>
			</div>
		
</div>
<div id="comments_pager_bottom"><div class="pager"><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#!comments" onclick="commentManager.renderComments(1,50);return false;">&lt; Prev</a><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#!comments" onclick="commentManager.renderComments(1,50);return false;">1</a><span class="current">2</span></div></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#" onclick="return RefreshPage();">刷新页面</a><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html#top">返回顶部</a></div>
<div id="comment_form_container">
<div id="commentform_title">发表评论</div>
<span id="tip_comment" style="color:Red"></span>
<p>
昵称：<input type="text" id="tbCommentAuthor" class="author" disabled="disabled" size="50" value="ZereL">
</p>
<div class="commentbox_main">
<div class="commentbox_title">
<div class="commentbox_title_left">评论内容：</div>
<div class="commentbox_title_right">
<img id="ubb_quote" class="comment_icon" src="./Entity Framework之深入分析_files/quote.gif" alt="引用" title="添加引用" onclick="insertUBB(&#39;tbCommentBody&#39;,&#39;quote&#39;)">
<img id="ubb_bold" class="comment_icon" src="./Entity Framework之深入分析_files/b.png" alt="粗体" title="添加粗体" onclick="insertUBB(&#39;tbCommentBody&#39;,&#39;b&#39;)">
<img id="ubb_url" class="comment_icon" src="./Entity Framework之深入分析_files/lk.png" alt="链接" title="添加链接" onclick="insertUbbUrl(&#39;tbCommentBody&#39;)">
<img id="ubb_indent" class="comment_icon" src="./Entity Framework之深入分析_files/indent.png" alt="缩进" title="添加首行缩进" onclick="insertIndent(&#39;tbCommentBody&#39;)">
<img id="ubb_code" class="comment_icon" src="./Entity Framework之深入分析_files/InsertCode.gif" alt="代码" title="添加代码" onclick="insertUbbCode()">
<img id="ubb_img" class="comment_icon" src="./Entity Framework之深入分析_files/img.gif" alt="图片" title="上传图片" onclick="OpenImageUploadWindow();">
</div>
</div>
<div class="clear"></div>
<textarea id="tbCommentBody" class="comment_textarea"></textarea>
</div>
<p id="commentbox_opt">
<input id="btn_comment_submit" type="button" class="comment_btn" value="提交评论">
<span id="span_comment_canceledit" style="display:none"><a href="javascript:void(0);" onclick="return CancelCommentEdit()">不改了</a></span>
<a href="javascript:void(0);" onclick="return logout();">退出</a>
        <a id="commentbox_opt_sub" href="javascript:void(0);" title="订阅后有新评论时会邮件通知您" onclick="commentManager.Subscribe()">订阅评论</a>
</p>
<div id="tip_comment2" style="color:Red"></div>
<p>
[Ctrl+Enter快捷键提交]
</p>
<div style="display:none">
<span id="comment_edit_id"></span><span id="span_parentcomment_id"></span>
<span id="span_parent_id"></span>
<span id="span_comment_replyto"></span>
<span id="span_comment_posted"></span>
</div>
</div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"></div>
<div id="opt_under_post"></div>
<div id="cnblogs_c1" class="c_ad_block"></div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="https://news.cnblogs.com/n/586095/" target="_blank">每日优鲜宣布便利购分拆独立运营 融资2亿美元</a><br> ·  <a href="https://news.cnblogs.com/n/586105/" target="_blank">腾讯“企鹅医典”正式亮相，联合健康时报做医学科普</a><br> ·  <a href="https://news.cnblogs.com/n/586104/" target="_blank">基本收入实验得到了500万美元的比特币捐赠</a><br> ·  <a href="https://news.cnblogs.com/n/586103/" target="_blank">蚂蚁宝卡免流时代开启：天猫/淘宝/钉钉支持免流</a><br> ·  <a href="https://news.cnblogs.com/n/586102/" target="_blank">微博微卡全面升级：金V卡20GB流量＋2000分钟通话</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="cnblogs_c2" class="c_ad_block"></div>
<div id="under_post_kb"><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/585502/" target="_blank">步入云计算</a><br> ·  <a href="http://kb.cnblogs.com/page/531409/" target="_blank">以操作系统的角度述说线程与进程</a><br> ·  <a href="http://kb.cnblogs.com/page/141729/" target="_blank">软件测试转型之路</a><br> ·  <a href="http://kb.cnblogs.com/page/177402/" target="_blank">门内门外看招聘</a><br> ·  <a href="http://kb.cnblogs.com/page/112506/" target="_blank">大道至简，职场上做人做事做管理</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


</div>
</div>
<div id="leftmenu">


<h3>导航</h3>
<ul>
<li>
<a id="blog_nav_sitehome" href="http://www.cnblogs.com/">博客园</a></li>
<li>
<a id="blog_nav_myhome" class="two_words" href="http://www.cnblogs.com/mecity/">首页</a></li>
<li>
<a id="blog_nav_newpost" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li>
<a id="blog_nav_contact" accesskey="9" class="two_words" rel="nofollow" href="https://msg.cnblogs.com/send/%E5%B0%8F%E5%9F%8E%E5%B2%81%E6%9C%88">联系</a></li>
<li>
<a id="blog_nav_rss" class="two_words" href="http://www.cnblogs.com/mecity/rss">订阅</a>
<a id="blog_nav_rss_image" href="http://www.cnblogs.com/mecity/rss"><img src="./Entity Framework之深入分析_files/xml.gif" alt="订阅"></a>
</li>
<li>
<a id="blog_nav_admin" class="two_words" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>

<div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2011/06/01&#39;);return false;">&lt;</a></td><td align="center">2011年7月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2011/08/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">26</td><td class="CalOtherMonthDay" align="center">27</td><td class="CalOtherMonthDay" align="center">28</td><td class="CalOtherMonthDay" align="center">29</td><td class="CalOtherMonthDay" align="center">30</td><td align="center">1</td><td class="CalWeekendDay" align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/02.html"><u>2</u></a></td></tr><tr><td class="CalWeekendDay" align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/03.html"><u>3</u></a></td><td align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/04.html"><u>4</u></a></td><td align="center">5</td><td align="center">6</td><td align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/07.html"><u>7</u></a></td><td align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/08.html"><u>8</u></a></td><td class="CalWeekendDay" align="center">9</td></tr><tr><td class="CalWeekendDay" align="center">10</td><td align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/11.html"><u>11</u></a></td><td align="center">12</td><td align="center">13</td><td align="center">14</td><td align="center">15</td><td class="CalWeekendDay" align="center">16</td></tr><tr><td class="CalWeekendDay" align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/17.html"><u>17</u></a></td><td align="center">18</td><td align="center">19</td><td align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/20.html"><u>20</u></a></td><td align="center">21</td><td align="center">22</td><td class="CalWeekendDay" align="center">23</td></tr><tr><td class="CalWeekendDay" align="center">24</td><td align="center"><a href="http://www.cnblogs.com/mecity/archive/2011/07/25.html"><u>25</u></a></td><td align="center">26</td><td align="center">27</td><td align="center">28</td><td align="center">29</td><td class="CalWeekendDay" align="center">30</td></tr><tr><td class="CalWeekendDay" align="center">31</td><td class="CalOtherMonthDay" align="center">1</td><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
<meta name="vs_showGrid" content="False">

<h3>公告</h3>
<div id="blog-news"><!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END --><div id="profile_block">昵称：<a href="https://home.cnblogs.com/u/mecity/">小城岁月</a><br>园龄：<a href="https://home.cnblogs.com/u/mecity/" title="入园时间：2010-05-06">7年7个月</a><br>粉丝：<a href="https://home.cnblogs.com/u/mecity/followers/">487</a><br>关注：<a href="https://home.cnblogs.com/u/mecity/followees/">30</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="follow(&#39;61e274ad-e258-df11-ba8f-001cf0cd104b&#39;)">+加关注</a></div></div></div><script type="text/javascript">loadBlogNews();</script>

<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>
<div id="widget_my_google" class="div_my_zzk"><input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="http://www.cnblogs.com/mecity/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="http://www.cnblogs.com/mecity/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="http://www.cnblogs.com/mecity/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="http://www.cnblogs.com/mecity/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="http://www.cnblogs.com/mecity/tag/" title="我的博客的标签列表">我的标签</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">

</div></div><div id="sidebar_recentposts" class="sidebar-block">
<h3 class="catListTitle">最新随笔</h3>
<div class="RecentComment" id="RecentPosts">
<ul style="word-break:break-all">
<li><a href="http://www.cnblogs.com/mecity/archive/2012/01/17/WCF.html">1. WCF X.509证书创建与IIS宿主设置</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/11/18/2253899.html">2. CLR Via笔记之ThreadPool/Task</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/11/16/2251010.html">3. CLR Via笔记之.NET 4.0 并行Parallel</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/11/13/2246933.html">4. .NET 序列化与反序化</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/11/12/2246114.html">5. CLR VIA反射性能比较的例子</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/11/08/2240526.html">6. 进程/线程/线程安全/静态类 杂谈</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/10/29/2228579.html">7. EF 最近发展小记</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/10/28/2227954.html">8. VS IDE 引用.net 项增加其它DLL项方法</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/10/27/2226214.html">9. GC/Windbg/IDisposable/IL/MeteData/JIT 杂谈</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/10/20/2219621.html">10. JS图片素材及JQueryUI样式设计</a></li>
</ul>
</div>
</div><div id="sidebar_toptags" class="sidebar-block">
<h3 class="catListTitle">我的标签</h3>
<div id="MyTag">
<ul>
<li><a href="http://www.cnblogs.com/mecity/tag/mongodb/">mongodb</a>(12)</li><li><a href="http://www.cnblogs.com/mecity/tag/mongo%20for%20.net/">mongo for .net</a>(6)</li><li><a href="http://www.cnblogs.com/mecity/tag/nosql/">nosql</a>(6)</li><li><a href="http://www.cnblogs.com/mecity/tag/memcached/">memcached</a>(5)</li><li><a href="http://www.cnblogs.com/mecity/tag/.net%20mvc/">.net mvc</a>(5)</li><li><a href="http://www.cnblogs.com/mecity/tag/EntityFramework/">EntityFramework</a>(5)</li><li><a href="http://www.cnblogs.com/mecity/tag/cache/">cache</a>(4)</li><li><a href="http://www.cnblogs.com/mecity/tag/memcache/">memcache</a>(3)</li><li><a href="http://www.cnblogs.com/mecity/tag/nginx/">nginx</a>(3)</li><li><a href="http://www.cnblogs.com/mecity/tag/Nhibernate/">Nhibernate</a>(2)</li><li><a href="http://www.cnblogs.com/mecity/tag/">更多</a></li>
</ul>
</div></div><div id="sidebar_categories">
		<h3>随笔分类</h3>
		
				<ul>
			
				<li><a id="CatList_LinkList_0_Link_0" href="http://www.cnblogs.com/mecity/category/304879.html">C#(14)</a></li>
			
				<li><a id="CatList_LinkList_0_Link_1" href="http://www.cnblogs.com/mecity/category/304877.html">Entity Framework(6)</a></li>
			
				<li><a id="CatList_LinkList_0_Link_2" href="http://www.cnblogs.com/mecity/category/304875.html">Memcached(5)</a></li>
			
				<li><a id="CatList_LinkList_0_Link_3" href="http://www.cnblogs.com/mecity/category/304803.html">MongoDB(13)</a></li>
			
				<li><a id="CatList_LinkList_0_Link_4" href="http://www.cnblogs.com/mecity/category/304878.html">MVC(5)</a></li>
			
				<li><a id="CatList_LinkList_0_Link_5" href="http://www.cnblogs.com/mecity/category/304876.html">Nginx(3)</a></li>
			
				<li><a id="CatList_LinkList_0_Link_6" href="http://www.cnblogs.com/mecity/category/308167.html">Windows Server AppFabric (1)</a></li>
			
				<li><a id="CatList_LinkList_0_Link_7" href="http://www.cnblogs.com/mecity/category/311131.html">文章导航(1)</a></li>
			
				</ul>
			
	
		<h3>随笔档案</h3>
		
				<ul>
			
				<li><a id="CatList_LinkList_1_Link_0" href="http://www.cnblogs.com/mecity/archive/2012/01.html">2012年1月 (1)</a></li>
			
				<li><a id="CatList_LinkList_1_Link_1" href="http://www.cnblogs.com/mecity/archive/2011/11.html">2011年11月 (5)</a></li>
			
				<li><a id="CatList_LinkList_1_Link_2" href="http://www.cnblogs.com/mecity/archive/2011/10.html">2011年10月 (10)</a></li>
			
				<li><a id="CatList_LinkList_1_Link_3" href="http://www.cnblogs.com/mecity/archive/2011/09.html">2011年9月 (1)</a></li>
			
				<li><a id="CatList_LinkList_1_Link_4" href="http://www.cnblogs.com/mecity/archive/2011/07.html">2011年7月 (9)</a></li>
			
				<li><a id="CatList_LinkList_1_Link_5" href="http://www.cnblogs.com/mecity/archive/2011/06.html">2011年6月 (13)</a></li>
			
				</ul>
			
	</div><div id="sidebar_scorerank" class="sidebar-block">
<h3>积分与排名</h3>
<ul>
	<li>
		积分 -
		107201
	</li><li>
		排名 -
		2727
	</li>
</ul>
</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<h3 class="catListTitle">最新评论</h3>
<div class="RecentComment" id="RecentComments">
	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/mecity/archive/2012/01/17/WCF.html#3846673">1. Re:WCF X.509证书创建与IIS宿主设置</a></li>
        <li class="recent_comment_body">CurrentUser下为什么没有权限，需要怎么样设置可以取到？</li>
        <li class="recent_comment_author">--xingthx</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/mecity/archive/2011/06/20/2085529.html#3819091">2. Re:Nginx的负载均衡的那点事</a></li>
        <li class="recent_comment_body">继续学习</li>
        <li class="recent_comment_author">--师哥</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/mecity/archive/2011/10/16/2214386.html#3787770">3. Re:Quartz.Net 调度框架配置介绍</a></li>
        <li class="recent_comment_body">我尝试了下，getscheduler好像会自动加载xml里配置的job， XMLSchedulingDataProcessor processor = new XMLSchedulingDataPro......</li>
        <li class="recent_comment_author">--jmlsaul</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/mecity/archive/2011/06/20/2085529.html#3759540">4. Re:Nginx的负载均衡的那点事</a></li>
        <li class="recent_comment_body">深度好文，分析得很到位，现在应该用memcached和redis做session比较多吧，高速缓存。</li>
        <li class="recent_comment_author">--(_灬絶℡情乄</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/mecity/archive/2011/10/16/2214386.html#3712392">5. Re:Quartz.Net 调度框架配置介绍</a></li>
        <li class="recent_comment_body">@BruceGoGo有没有在IIS上避免被回收的 还是只有放Windows服务一条路？...</li>
        <li class="recent_comment_author">--_York</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<h3 class="catListTitle">阅读排行榜</h3>
<div class="RecentComment" id="TopViewPosts"> 
	<div id="TopViewPostsBlock"><ul><li><a href="http://www.cnblogs.com/mecity/archive/2011/06/11/2078527.html">1. 第一节 MongoDB介绍及下载与安装(143300)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/07/2099598.html">2. Entity Framework之犹豫不决(63709)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html">3. Entity Framework之深入分析(39766)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/06/20/2085529.html">4. Nginx的负载均衡的那点事(35621)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/11/2102475.html">5. Entity Framework之查询总结(28311)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<h3 class="catListTitle">评论排行榜</h3>
<div class="RecentComment" id="TopCommentsPosts">
	<div id="TopFeedbackPostsBlock"><ul><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/07/2099598.html">1. Entity Framework之犹豫不决(134)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html">2. Entity Framework之深入分析(54)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/09/30/2195075.html">3. .NET MVC权限设计思考之切入点(40)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/11/2102475.html">4. Entity Framework之查询总结(38)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/08/2099853.html">5. Entity Framework之问题收集(30)</a></li></ul></div>
</div></div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<h3 class="catListTitle">推荐排行榜</h3>
<div class="RecentComment">
	<div id="TopDiggPostsBlock"><ul><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/07/2099598.html">1. Entity Framework之犹豫不决(42)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/17/2108508.html">2. Entity Framework之深入分析(37)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/08/2099853.html">3. Entity Framework之问题收集(23)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/06/11/2078527.html">4. 第一节 MongoDB介绍及下载与安装(22)</a></li><li><a href="http://www.cnblogs.com/mecity/archive/2011/07/20/2112133.html">5. 项目铺垫系列导航目录(22)</a></li></ul></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>

</div>
</div>
<div class="clear"></div>
<div id="footer">

<p id="footer">
	Powered by: 
	<br>
	
	<a id="Footer1_Hyperlink3" name="Hyperlink1" href="http://www.cnblogs.com/" style="font-family:Verdana;font-size:12px;">博客园</a>
	<br>
	Copyright © 小城岁月
</p>
</div>
</div>

<!--PageEndHtml Block Begin-->
面朝大海，春暖花开！
<!--PageEndHtml Block End-->


</body></html>